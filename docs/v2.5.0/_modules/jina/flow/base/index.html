<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../../genindex/" /><link rel="search" title="Search" href="../../../../search/" />

    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/><meta name="generator" content="sphinx-4.3.1, furo 2021.10.09"/>
        <title>jina.flow.base - Jina 2.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?digest=0254c309f5cadf746f1a613e7677379ac9c8cdcd" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.59c74d8c95b765a7fd995ac71d459ebe.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?digest=16fb25fabf47304eee183a5e9af80b1ba98259b1" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/docbot.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: #4d4d4d;
  --color-brand-primary: #009191;
  --color-brand-content: #009191;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FBCB67;
  --color-brand-content: #FBCB67;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FBCB67;
  --color-brand-content: #FBCB67;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
    <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
    <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
    <header class="mobile-header" id="mobile-header">
        <div class="header-left">
            <label class="nav-overlay-icon" for="__navigation">
                <div class="visually-hidden">Toggle site navigation sidebar</div>
                <i class="icon">
                    <svg>
                        <use href="#svg-menu"></use>
                    </svg>
                </i>
            </label>
        </div>
        <div class="header-center">
            <a href="../../../../">
                <div class="brand">Jina 2.5.0 documentation</div>
            </a>
        </div>
        <div class="header-right">
            <div class="theme-toggle-container theme-toggle-header">
                <button class="theme-toggle">
                    <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
                    <svg class="theme-icon-when-auto">
                        <use href="#svg-sun-half"></use>
                    </svg>
                    <svg class="theme-icon-when-dark">
                        <use href="#svg-moon"></use>
                    </svg>
                    <svg class="theme-icon-when-light">
                        <use href="#svg-sun"></use>
                    </svg>
                </button>
            </div>
            <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
                <div class="visually-hidden">Toggle table of contents sidebar</div>
                <i class="icon">
                    <svg>
                        <use href="#svg-toc"></use>
                    </svg>
                </i>
            </label>
        </div>
    </header>
    <aside class="sidebar-drawer" id="sidebar-drawer">
        <div class="sidebar-container">
            
            <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../../_static/logo-light.svg" alt="Light Logo" />
    <img class="sidebar-logo only-dark" src="../../../../_static/logo-dark.svg" alt="Dark Logo" />
  </div>
  
  
</a>
<div class="sd-d-flex-row sd-align-major-spaced">
  <a class="github-button" href="https://github.com/jina-ai/jina" data-icon="octicon-star" data-show-count="true" aria-label="Star jina-ai/jina on GitHub" style="opacity: 0;">Star</a>
  <select onChange="window.location.href=this.value" class="version-select">
    
        
          
          
            <option value="../../../../index.html" >latest(v2.5.1)</option>
          
        
        
          
            <option value="base.html" selected="selected" >v2.5.0</option>
          
        
    
  </select>
</div><form class="sidebar-search-container" method="get" action="../../../../search/" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
    <p class="caption" role="heading"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../get-started/neural-search/">What is Neural Search?</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../get-started/install/">Install</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/experimental/windows/">Jina on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../get-started/install/troubleshooting/">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../get-started/hello-world/">Run Quick Demos</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../get-started/hello-world/fashion/">Fashion image search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../get-started/hello-world/covid-19-chatbot/">Covid-19 chatbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../get-started/hello-world/multimodal/">Multimodal search</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Fundamentals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../fundamentals/concepts/">Basic Concepts</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../fundamentals/document/">Document</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../fundamentals/document/document-api/">Document</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../fundamentals/document/fluent-interface/">Fluent Interface</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../fundamentals/document/documentarray/">DocumentArray</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../fundamentals/document/documentarraymemmap-api/">DocumentArrayMemmap</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../fundamentals/executor/">Executor</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/executor/executor-api/">Create Executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/executor/executor-built-in-features/">Executor Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/executor/executors-in-action/">Executor in Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/executor/repository-structure/">Executor File Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/gpu-executor/">Run Executors on GPU</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../fundamentals/flow/">Flow</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/flow/flow-api/">Create Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/flow/send-recv/">Flow IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/flow/add-exec-to-flow/">Add Executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/flow/topology/">Distributed &amp; Parallel Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/flow/async-flow/">Asynchronous Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/flow/flow-as-a-service/">Serving Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals/flow/remarks/">Remarks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fundamentals/clean-code/">Clean &amp; Efficient Code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Types</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../datatype/text/"><svg aria-hidden="true" class="sd-octicon sd-octicon-typography" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M6.21 8.5L4.574 3.594 2.857 8.5H6.21zm.5 1.5l.829 2.487a.75.75 0 001.423-.474L5.735 2.332a1.216 1.216 0 00-2.302-.018l-3.39 9.688a.75.75 0 001.415.496L2.332 10H6.71zm3.13-4.358C10.53 4.374 11.87 4 13 4c1.5 0 3 .939 3 2.601v5.649a.75.75 0 01-1.448.275C13.995 12.82 13.3 13 12.5 13c-.77 0-1.514-.231-2.078-.709-.577-.488-.922-1.199-.922-2.041 0-.694.265-1.411.887-1.944C11 7.78 11.88 7.5 13 7.5h1.5v-.899c0-.54-.5-1.101-1.5-1.101-.869 0-1.528.282-1.84.858a.75.75 0 11-1.32-.716zM14.5 9H13c-.881 0-1.375.22-1.637.444-.253.217-.363.5-.363.806 0 .408.155.697.39.896.249.21.63.354 1.11.354.732 0 1.26-.209 1.588-.449.35-.257.412-.495.412-.551V9z" fill-rule="evenodd"></path></svg> Text</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/fuzzy-grep/">Fuzzy String Matching in 30 Lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../datatype/text/full-text-search/">Full Text Search via Feature Hashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/chatbot/">Question-Answering Chatbot via Transformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/question-answering-bot/">Open-Domain Question-Answering on Long Document</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../datatype/image/"><svg aria-hidden="true" class="sd-octicon sd-octicon-image" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M1.75 2.5a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h.94a.76.76 0 01.03-.03l6.077-6.078a1.75 1.75 0 012.412-.06L14.5 10.31V2.75a.25.25 0 00-.25-.25H1.75zm12.5 11H4.81l5.048-5.047a.25.25 0 01.344-.009l4.298 3.889v.917a.25.25 0 01-.25.25zm1.75-.25V2.75A1.75 1.75 0 0014.25 1H1.75A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25zM5.5 6a.5.5 0 11-1 0 .5.5 0 011 0zM7 6a2 2 0 11-4 0 2 2 0 014 0z" fill-rule="evenodd"></path></svg> Image</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../datatype/image/image2image/">Search Similar Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../datatype/image/text2image/">Search Image from Text via CLIP model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../datatype/image/small-images-inside-big-images/">Find Small Images Inside Large Images</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../datatype/video/"><svg aria-hidden="true" class="sd-octicon sd-octicon-device-camera-video" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M16 3.75a.75.75 0 00-1.136-.643L11 5.425V4.75A1.75 1.75 0 009.25 3h-7.5A1.75 1.75 0 000 4.75v6.5C0 12.216.784 13 1.75 13h7.5A1.75 1.75 0 0011 11.25v-.675l3.864 2.318A.75.75 0 0016 12.25v-8.5zm-5 5.075l3.5 2.1v-5.85l-3.5 2.1v1.65zM9.5 6.75v-2a.25.25 0 00-.25-.25h-7.5a.25.25 0 00-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-4.5z" fill-rule="evenodd"></path></svg> Video</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/video-qa/">Question-Answering on in-Video Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/video-search/">Search in-Video Visual Content via Text</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../datatype/audio/"><svg aria-hidden="true" class="sd-octicon sd-octicon-unmute" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M7.563 2.069A.75.75 0 018 2.75v10.5a.75.75 0 01-1.238.57L3.472 11H1.75A1.75 1.75 0 010 9.25v-2.5C0 5.784.784 5 1.75 5h1.723l3.289-2.82a.75.75 0 01.801-.111zM6.5 4.38L4.238 6.319a.75.75 0 01-.488.181h-2a.25.25 0 00-.25.25v2.5c0 .138.112.25.25.25h2a.75.75 0 01.488.18L6.5 11.62V4.38zm6.096-2.038a.75.75 0 011.06 0 8 8 0 010 11.314.75.75 0 01-1.06-1.06 6.5 6.5 0 000-9.193.75.75 0 010-1.06v-.001zm-1.06 2.121a.75.75 0 10-1.061 1.061 3.5 3.5 0 010 4.95.75.75 0 101.06 1.06 5 5 0 000-7.07l.001-.001z" fill-rule="evenodd"></path></svg> Audio</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../datatype/audio/similar-audio-search/">Search Similar Audios</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../datatype/mesh/"><svg aria-hidden="true" class="sd-octicon sd-octicon-package" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M8.878.392a1.75 1.75 0 00-1.756 0l-5.25 3.045A1.75 1.75 0 001 4.951v6.098c0 .624.332 1.2.872 1.514l5.25 3.045a1.75 1.75 0 001.756 0l5.25-3.045c.54-.313.872-.89.872-1.514V4.951c0-.624-.332-1.2-.872-1.514L8.878.392zM7.875 1.69a.25.25 0 01.25 0l4.63 2.685L8 7.133 3.245 4.375l4.63-2.685zM2.5 5.677v5.372c0 .09.047.171.125.216l4.625 2.683V8.432L2.5 5.677zm6.25 8.271l4.625-2.683a.25.25 0 00.125-.216V5.677L8.75 8.432v5.516z" fill-rule="evenodd"></path></svg> 3D Mesh</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../datatype/mesh/mesh-search/">Search Similar 3D Meshes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../datatype/tabular/"><svg aria-hidden="true" class="sd-octicon sd-octicon-table" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v3.585a.746.746 0 010 .83v8.085A1.75 1.75 0 0114.25 16H6.309a.748.748 0 01-1.118 0H1.75A1.75 1.75 0 010 14.25V6.165a.746.746 0 010-.83V1.75zM1.5 6.5v7.75c0 .138.112.25.25.25H5v-8H1.5zM5 5H1.5V1.75a.25.25 0 01.25-.25H5V5zm1.5 1.5v8h7.75a.25.25 0 00.25-.25V6.5h-8zm8-1.5h-8V1.5h7.75a.25.25 0 01.25.25V5z" fill-rule="evenodd"></path></svg> Table</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../datatype/tabular/filter-via-neural-search/">Filter Table Rows by Attributes</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../advanced/hub/">Share Executors via Hub</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/hub/hub-portal/">Hub Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/hub/create-hub-executor/">Create Executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/hub/push-executor/">Publish Executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/hub/use-hub-executor/">Use Hub Executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/hub/executor-best-practices/">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/master-executor/">Master Executor: from Zero to Hub</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../advanced/daemon/">Remote Executors and Flows via JinaD</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/daemon/jinad-server/">JinaD Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/daemon/jinad-client/">JinaD Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/daemon/remote-executors/">Remote Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/daemon/workspace/">Workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/daemon/remote-flows/">Remote Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/daemon/stream-remote-logs/">Remote Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/daemon/development-using-jinad/">JinaD Development Guides</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../advanced/experimental/"><svg aria-hidden="true" class="sd-octicon sd-octicon-beaker" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M5 5.782V2.5h-.25a.75.75 0 010-1.5h6.5a.75.75 0 010 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458L5 5.782zM9.5 2.5h-3V6a.75.75 0 01-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 019.5 6V2.5zm-6.9 9.847L3.775 10.5h8.45l1.175 1.847a.75.75 0 01-.633 1.153H3.233a.75.75 0 01-.633-1.153z" fill-rule="evenodd"></path></svg> Experimental Features</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/experimental/kubernetes/">Jina on Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../advanced/experimental/indexers/">Indexers on Jina Hub</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../api/jina/">jina package</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.clients/">jina.clients package</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.clients.base/">jina.clients.base package</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.clients.base.grpc/">jina.clients.base.grpc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.clients.base.helper/">jina.clients.base.helper module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.clients.base.http/">jina.clients.base.http module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.clients.base.websocket/">jina.clients.base.websocket module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.clients.request/">jina.clients.request package</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.clients.request.asyncio/">jina.clients.request.asyncio module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.clients.request.helper/">jina.clients.request.helper module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.clients.grpc/">jina.clients.grpc module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.clients.helper/">jina.clients.helper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.clients.http/">jina.clients.http module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.clients.mixin/">jina.clients.mixin module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.clients.websocket/">jina.clients.websocket module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.executors/">jina.executors package</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.executors.decorators/">jina.executors.decorators module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.executors.metas/">jina.executors.metas module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.flow/">jina.flow package</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.flow.asyncio/">jina.flow.asyncio module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.flow.base/">jina.flow.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.flow.builder/">jina.flow.builder module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.helloworld/">jina.helloworld package</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.helloworld.chatbot/">jina.helloworld.chatbot package</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.helloworld.chatbot.app/">jina.helloworld.chatbot.app module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.helloworld.chatbot.my_executors/">jina.helloworld.chatbot.my_executors module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.helloworld.fashion/">jina.helloworld.fashion package</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.helloworld.fashion.app/">jina.helloworld.fashion.app module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.helloworld.fashion.helper/">jina.helloworld.fashion.helper module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.helloworld.fashion.my_executors/">jina.helloworld.fashion.my_executors module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.helloworld.multimodal/">jina.helloworld.multimodal package</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.helloworld.multimodal.app/">jina.helloworld.multimodal.app module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.helloworld.multimodal.my_executors/">jina.helloworld.multimodal.my_executors module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.helloworld.fork/">jina.helloworld.fork module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.hubble/">jina.hubble package</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.hubble.helper/">jina.hubble.helper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.hubble.hubapi/">jina.hubble.hubapi module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.hubble.hubio/">jina.hubble.hubio module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.jaml/">jina.jaml package</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.jaml.parsers/">jina.jaml.parsers package</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.jaml.parsers.default/">jina.jaml.parsers.default package</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.jaml.parsers.default.v1/">jina.jaml.parsers.default.v1 module</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.jaml.parsers.executor/">jina.jaml.parsers.executor package</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.jaml.parsers.executor.legacy/">jina.jaml.parsers.executor.legacy module</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.jaml.parsers.flow/">jina.jaml.parsers.flow package</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.jaml.parsers.flow.legacy/">jina.jaml.parsers.flow.legacy module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.jaml.parsers.flow.v1/">jina.jaml.parsers.flow.v1 module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.jaml.parsers.base/">jina.jaml.parsers.base module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.jaml.helper/">jina.jaml.helper module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.logging/">jina.logging package</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.logging.formatter/">jina.logging.formatter module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.logging.logger/">jina.logging.logger module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.logging.predefined/">jina.logging.predefined module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.logging.profile/">jina.logging.profile module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.math/">jina.math package</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.math.distance/">jina.math.distance package</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.math.distance.numpy/">jina.math.distance.numpy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.math.distance.paddle/">jina.math.distance.paddle module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.math.distance.tensorflow/">jina.math.distance.tensorflow module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.math.distance.torch/">jina.math.distance.torch module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.math.dimensionality_reduction/">jina.math.dimensionality_reduction module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.math.evaluation/">jina.math.evaluation module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.math.helper/">jina.math.helper module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.optimizers/">jina.optimizers package</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.optimizers.discovery/">jina.optimizers.discovery module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.optimizers.flow_runner/">jina.optimizers.flow_runner module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.optimizers.parameters/">jina.optimizers.parameters module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.parsers/">jina.parsers package</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.parsers.hubble/">jina.parsers.hubble package</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.parsers.hubble.new/">jina.parsers.hubble.new module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.parsers.hubble.pull/">jina.parsers.hubble.pull module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.parsers.hubble.push/">jina.parsers.hubble.push module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.parsers.peapods/">jina.parsers.peapods package</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.parsers.peapods.runtimes/">jina.parsers.peapods.runtimes package</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.parsers.peapods.runtimes.container/">jina.parsers.peapods.runtimes.container module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.parsers.peapods.runtimes.distributed/">jina.parsers.peapods.runtimes.distributed module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.parsers.peapods.runtimes.remote/">jina.parsers.peapods.runtimes.remote module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.parsers.peapods.runtimes.zed/">jina.parsers.peapods.runtimes.zed module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.parsers.peapods.runtimes.zmq/">jina.parsers.peapods.runtimes.zmq module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.parsers.peapods.base/">jina.parsers.peapods.base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.parsers.peapods.pea/">jina.parsers.peapods.pea module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.parsers.peapods.pod/">jina.parsers.peapods.pod module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.base/">jina.parsers.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.client/">jina.parsers.client module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.deprecated/">jina.parsers.deprecated module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.export_api/">jina.parsers.export_api module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.flow/">jina.parsers.flow module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.helloworld/">jina.parsers.helloworld module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.helper/">jina.parsers.helper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.optimizer/">jina.parsers.optimizer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.parsers.ping/">jina.parsers.ping module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.peapods/">jina.peapods package</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.peapods.grpc/">jina.peapods.grpc package</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.peapods.peas/">jina.peapods.peas package</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.peas.helper/">jina.peapods.peas.helper module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.peapods.pods/">jina.peapods.pods package</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.peapods.pods.k8slib/">jina.peapods.pods.k8slib package</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.pods.k8slib.kubernetes_client/">jina.peapods.pods.k8slib.kubernetes_client module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.pods.k8slib.kubernetes_deployment/">jina.peapods.pods.k8slib.kubernetes_deployment module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.pods.k8slib.kubernetes_tools/">jina.peapods.pods.k8slib.kubernetes_tools module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.pods.compound/">jina.peapods.pods.compound module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.pods.factory/">jina.peapods.pods.factory module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.pods.k8s/">jina.peapods.pods.k8s module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.peapods.runtimes/">jina.peapods.runtimes package</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.container/">jina.peapods.runtimes.container package</a><input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" role="switch" type="checkbox"/><label for="toctree-checkbox-46"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.container.helper/">jina.peapods.runtimes.container.helper module</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.gateway/">jina.peapods.runtimes.gateway package</a><input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" role="switch" type="checkbox"/><label for="toctree-checkbox-47"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.gateway.grpc/">jina.peapods.runtimes.gateway.grpc package</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.gateway.http/">jina.peapods.runtimes.gateway.http package</a><input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" role="switch" type="checkbox"/><label for="toctree-checkbox-48"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.gateway.http.app/">jina.peapods.runtimes.gateway.http.app module</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.gateway.http.models/">jina.peapods.runtimes.gateway.http.models module</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.gateway.websocket/">jina.peapods.runtimes.gateway.websocket package</a><input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" role="switch" type="checkbox"/><label for="toctree-checkbox-49"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.gateway.websocket.app/">jina.peapods.runtimes.gateway.websocket.app module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.grpc/">jina.peapods.runtimes.grpc package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.jinad/">jina.peapods.runtimes.jinad package</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.request_handlers/">jina.peapods.runtimes.request_handlers package</a><input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" role="switch" type="checkbox"/><label for="toctree-checkbox-50"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.request_handlers.data_request_handler/">jina.peapods.runtimes.request_handlers.data_request_handler module</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.zmq/">jina.peapods.runtimes.zmq package</a><input class="toctree-checkbox" id="toctree-checkbox-51" name="toctree-checkbox-51" role="switch" type="checkbox"/><label for="toctree-checkbox-51"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.zmq.asyncio/">jina.peapods.runtimes.zmq.asyncio module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.zmq.zed/">jina.peapods.runtimes.zmq.zed module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.runtimes.base/">jina.peapods.runtimes.base module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.peapods.stream/">jina.peapods.stream package</a><input class="toctree-checkbox" id="toctree-checkbox-52" name="toctree-checkbox-52" role="switch" type="checkbox"/><label for="toctree-checkbox-52"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.stream.base/">jina.peapods.stream.base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.stream.client/">jina.peapods.stream.client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.stream.gateway/">jina.peapods.stream.gateway module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.peapods.stream.helper/">jina.peapods.stream.helper module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.peapods.zmq/">jina.peapods.zmq package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.peapods.networking/">jina.peapods.networking module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.proto/">jina.proto package</a><input class="toctree-checkbox" id="toctree-checkbox-53" name="toctree-checkbox-53" role="switch" type="checkbox"/><label for="toctree-checkbox-53"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.proto.jina_pb2/">jina.proto.jina_pb2 module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.proto.jina_pb2_grpc/">jina.proto.jina_pb2_grpc module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.proto.serializer/">jina.proto.serializer module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.schemas/">jina.schemas package</a><input class="toctree-checkbox" id="toctree-checkbox-54" name="toctree-checkbox-54" role="switch" type="checkbox"/><label for="toctree-checkbox-54"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.schemas.executor/">jina.schemas.executor module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.schemas.flow/">jina.schemas.flow module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.schemas.helper/">jina.schemas.helper module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.schemas.meta/">jina.schemas.meta module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.schemas.pod/">jina.schemas.pod module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../api/jina.types/">jina.types package</a><input class="toctree-checkbox" id="toctree-checkbox-55" name="toctree-checkbox-55" role="switch" type="checkbox"/><label for="toctree-checkbox-55"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.types.arrays/">jina.types.arrays package</a><input class="toctree-checkbox" id="toctree-checkbox-56" name="toctree-checkbox-56" role="switch" type="checkbox"/><label for="toctree-checkbox-56"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.types.arrays.memmap/">jina.types.arrays.memmap package</a><input class="toctree-checkbox" id="toctree-checkbox-57" name="toctree-checkbox-57" role="switch" type="checkbox"/><label for="toctree-checkbox-57"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.memmap.bpm/">jina.types.arrays.memmap.bpm module</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins/">jina.types.arrays.mixins package</a><input class="toctree-checkbox" id="toctree-checkbox-58" name="toctree-checkbox-58" role="switch" type="checkbox"/><label for="toctree-checkbox-58"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.io/">jina.types.arrays.mixins.io package</a><input class="toctree-checkbox" id="toctree-checkbox-59" name="toctree-checkbox-59" role="switch" type="checkbox"/><label for="toctree-checkbox-59"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.io.binary/">jina.types.arrays.mixins.io.binary module</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.io.common/">jina.types.arrays.mixins.io.common module</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.io.csv/">jina.types.arrays.mixins.io.csv module</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.io.from_gen/">jina.types.arrays.mixins.io.from_gen module</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.io.json/">jina.types.arrays.mixins.io.json module</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.content/">jina.types.arrays.mixins.content module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.embed/">jina.types.arrays.mixins.embed module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.empty/">jina.types.arrays.mixins.empty module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.evaluation/">jina.types.arrays.mixins.evaluation module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.getattr/">jina.types.arrays.mixins.getattr module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.group/">jina.types.arrays.mixins.group module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.magic/">jina.types.arrays.mixins.magic module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.match/">jina.types.arrays.mixins.match module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.plot/">jina.types.arrays.mixins.plot module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.sample/">jina.types.arrays.mixins.sample module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.text/">jina.types.arrays.mixins.text module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.arrays.mixins.traverse/">jina.types.arrays.mixins.traverse module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.arrays.chunk/">jina.types.arrays.chunk module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.arrays.document/">jina.types.arrays.document module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.arrays.match/">jina.types.arrays.match module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.arrays.types/">jina.types.arrays.types module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.types.document/">jina.types.document package</a><input class="toctree-checkbox" id="toctree-checkbox-60" name="toctree-checkbox-60" role="switch" type="checkbox"/><label for="toctree-checkbox-60"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../../api/jina.types.document.mixins/">jina.types.document.mixins package</a><input class="toctree-checkbox" id="toctree-checkbox-61" name="toctree-checkbox-61" role="switch" type="checkbox"/><label for="toctree-checkbox-61"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.attribute/">jina.types.document.mixins.attribute module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.audio/">jina.types.document.mixins.audio module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.buffer/">jina.types.document.mixins.buffer module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.content/">jina.types.document.mixins.content module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.convert/">jina.types.document.mixins.convert module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.dump/">jina.types.document.mixins.dump module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.helper/">jina.types.document.mixins.helper module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.image/">jina.types.document.mixins.image module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.mesh/">jina.types.document.mixins.mesh module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.plot/">jina.types.document.mixins.plot module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.sugar/">jina.types.document.mixins.sugar module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.text/">jina.types.document.mixins.text module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.version/">jina.types.document.mixins.version module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../../api/jina.types.document.mixins.video/">jina.types.document.mixins.video module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.document.generators/">jina.types.document.generators module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.document.graph/">jina.types.document.graph module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.document.helper/">jina.types.document.helper module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.types.message/">jina.types.message package</a><input class="toctree-checkbox" id="toctree-checkbox-62" name="toctree-checkbox-62" role="switch" type="checkbox"/><label for="toctree-checkbox-62"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.message.common/">jina.types.message.common module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.types.ndarray/">jina.types.ndarray package</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.types.request/">jina.types.request package</a><input class="toctree-checkbox" id="toctree-checkbox-63" name="toctree-checkbox-63" role="switch" type="checkbox"/><label for="toctree-checkbox-63"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.request.control/">jina.types.request.control module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.request.data/">jina.types.request.data module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.request.mixin/">jina.types.request.mixin module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.types.routing/">jina.types.routing package</a><input class="toctree-checkbox" id="toctree-checkbox-64" name="toctree-checkbox-64" role="switch" type="checkbox"/><label for="toctree-checkbox-64"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.routing.table/">jina.types.routing.table module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../../api/jina.types.score/">jina.types.score package</a><input class="toctree-checkbox" id="toctree-checkbox-65" name="toctree-checkbox-65" role="switch" type="checkbox"/><label for="toctree-checkbox-65"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../api/jina.types.score.map/">jina.types.score.map module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.types.list/">jina.types.list module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.types.mixin/">jina.types.mixin module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../api/jina.types.struct/">jina.types.struct module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/jina.checker/">jina.checker module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/jina.enums/">jina.enums module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/jina.excepts/">jina.excepts module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/jina.helper/">jina.helper module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/jina.importer/">jina.importer module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cli/">Jina Command-Line Interface</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../proto/">Jina Protobuf Specification</a><input class="toctree-checkbox" id="toctree-checkbox-66" name="toctree-checkbox-66" role="switch" type="checkbox"/><label for="toctree-checkbox-66"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>

    <p class="caption" role="heading"><span class="caption-text">Ecosystem</span></p>
    <ul>
        <li class="toctree-l1">
            <a class="reference internal" href="#">
                <img class="sidebar-ecosys-logo only-light-line" src="../../../../_static/search-light.svg">
                <img class="sidebar-ecosys-logo only-dark-line" src="../../../../_static/search-dark.svg">
                Jina</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://hub.jina.ai">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../../_static/hub-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../../_static/hub-dark.svg">
            Jina Hub</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://finetuner.jina.ai">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../../_static/finetuner-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../../_static/finetuner-dark.svg">
            Finetuner</a></li>
    </ul>
</div>
</div>
            </div>
            
        </div>
    </aside>
    <div class="main">
        <div class="content">
            <article role="main">
                <div class="content-icon-container">
                    <div class="theme-toggle-container theme-toggle-content">
                        <button class="theme-toggle">
                            <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
                            <svg class="theme-icon-when-auto">
                                <use href="#svg-sun-half"></use>
                            </svg>
                            <svg class="theme-icon-when-dark">
                                <use href="#svg-moon"></use>
                            </svg>
                            <svg class="theme-icon-when-light">
                                <use href="#svg-sun"></use>
                            </svg>
                        </button>
                    </div>
                    <label class="toc-overlay-icon toc-content-icon"
                           for="__toc">
                        <div class="visually-hidden">Toggle table of contents sidebar</div>
                        <i class="icon">
                            <svg>
                                <use href="#svg-toc"></use>
                            </svg>
                        </i>
                    </label>
                </div>
                <h1>Source code for jina.flow.base</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">ExitStack</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">.builder</span> <span class="kn">import</span> <span class="n">allowed_levels</span><span class="p">,</span> <span class="n">_hanging_pods</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">__default_host__</span>
<span class="kn">from</span> <span class="nn">..clients</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">..clients.mixin</span> <span class="kn">import</span> <span class="n">AsyncPostMixin</span><span class="p">,</span> <span class="n">PostMixin</span>
<span class="kn">from</span> <span class="nn">..enums</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FlowBuildLevel</span><span class="p">,</span>
    <span class="n">PodRoleType</span><span class="p">,</span>
    <span class="n">FlowInspectType</span><span class="p">,</span>
    <span class="n">GatewayProtocolType</span><span class="p">,</span>
    <span class="n">InfrastructureType</span><span class="p">,</span>
    <span class="n">PollingType</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..excepts</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FlowTopologyError</span><span class="p">,</span>
    <span class="n">FlowMissingPodError</span><span class="p">,</span>
    <span class="n">RoutingTableCyclicError</span><span class="p">,</span>
    <span class="n">RuntimeFailToStart</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..helper</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">colored</span><span class="p">,</span>
    <span class="n">get_public_ip</span><span class="p">,</span>
    <span class="n">get_internal_ip</span><span class="p">,</span>
    <span class="n">typename</span><span class="p">,</span>
    <span class="n">ArgNamespace</span><span class="p">,</span>
    <span class="n">download_mermaid_url</span><span class="p">,</span>
    <span class="n">CatchAllCleanupContextManager</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..jaml</span> <span class="kn">import</span> <span class="n">JAMLCompatible</span>
<span class="kn">from</span> <span class="nn">..logging.logger</span> <span class="kn">import</span> <span class="n">JinaLogger</span>
<span class="kn">from</span> <span class="nn">..parsers</span> <span class="kn">import</span> <span class="n">set_gateway_parser</span><span class="p">,</span> <span class="n">set_pod_parser</span><span class="p">,</span> <span class="n">set_client_cli_parser</span>
<span class="kn">from</span> <span class="nn">..parsers.flow</span> <span class="kn">import</span> <span class="n">set_flow_parser</span>
<span class="kn">from</span> <span class="nn">..peapods</span> <span class="kn">import</span> <span class="n">CompoundPod</span><span class="p">,</span> <span class="n">Pod</span>
<span class="kn">from</span> <span class="nn">..peapods.networking</span> <span class="kn">import</span> <span class="n">is_remote_local_connection</span>
<span class="kn">from</span> <span class="nn">..peapods.pods.factory</span> <span class="kn">import</span> <span class="n">PodFactory</span>
<span class="kn">from</span> <span class="nn">..peapods.pods.k8s</span> <span class="kn">import</span> <span class="n">K8sPod</span>
<span class="kn">from</span> <span class="nn">..types.routing.table</span> <span class="kn">import</span> <span class="n">RoutingTable</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Flow'</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">FlowType</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ExitStack</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">JAMLCompatible</span><span class="p">)):</span>
    <span class="sd">"""Type of Flow, metaclass of :class:`BaseFlow`"""</span>

    <span class="k">pass</span>


<span class="n">_regex_port</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'(.*?):([0-9]{1,4}|[1-5][0-9]</span><span class="si">{4}</span><span class="s1">|6[0-4][0-9]</span><span class="si">{3}</span><span class="s1">|65[0-4][0-9]</span><span class="si">{2}</span><span class="s1">|655[0-2][0-9]|6553[0-5])$'</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">..executors</span> <span class="kn">import</span> <span class="n">BaseExecutor</span>
    <span class="kn">from</span> <span class="nn">..clients.base</span> <span class="kn">import</span> <span class="n">BaseClient</span>
    <span class="kn">from</span> <span class="nn">.asyncio</span> <span class="kn">import</span> <span class="n">AsyncFlow</span>

<span class="n">GATEWAY_NAME</span> <span class="o">=</span> <span class="s1">'gateway'</span>
<span class="n">FALLBACK_PARSERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">set_gateway_parser</span><span class="p">(),</span>
    <span class="n">set_pod_parser</span><span class="p">(),</span>
    <span class="n">set_client_cli_parser</span><span class="p">(),</span>
    <span class="n">set_flow_parser</span><span class="p">(),</span>
<span class="p">]</span>


<div class="viewcode-block" id="Flow"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow">[docs]</a><span class="k">class</span> <span class="nc">Flow</span><span class="p">(</span><span class="n">PostMixin</span><span class="p">,</span> <span class="n">JAMLCompatible</span><span class="p">,</span> <span class="n">ExitStack</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">FlowType</span><span class="p">):</span>
    <span class="sd">"""Flow is how Jina streamlines and distributes Executors. """</span>

    <span class="k">class</span> <span class="nc">_FlowK8sInfraResourcesManager</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k8s_namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k8s_custom_resource_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="o">=</span> <span class="n">k8s_namespace</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k8s_custom_resource_dir</span> <span class="o">=</span> <span class="n">k8s_custom_resource_dir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namespace_created</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">..peapods.pods.k8slib</span> <span class="kn">import</span> <span class="n">kubernetes_tools</span><span class="p">,</span> <span class="n">kubernetes_client</span>

            <span class="n">client</span> <span class="o">=</span> <span class="n">kubernetes_client</span><span class="o">.</span><span class="n">K8sClients</span><span class="p">()</span><span class="o">.</span><span class="n">core_v1</span>
            <span class="n">list_namespaces</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">item</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">list_namespace</span><span class="p">()</span><span class="o">.</span><span class="n">items</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_namespaces</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">JinaLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">'create_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k8s_namespace</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="se">\t</span><span class="s1">Create Namespace "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k8s_namespace</span><span class="si">}</span><span class="s1">"'</span><span class="p">)</span>
                    <span class="n">kubernetes_tools</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                        <span class="s1">'namespace'</span><span class="p">,</span>
                        <span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s_namespace</span><span class="p">},</span>
                        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
                        <span class="n">custom_resource_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k8s_custom_resource_dir</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">namespace_created</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">..peapods.pods.k8slib</span> <span class="kn">import</span> <span class="n">kubernetes_client</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace_created</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">kubernetes_client</span><span class="o">.</span><span class="n">K8sClients</span><span class="p">()</span><span class="o">.</span><span class="n">core_v1</span>
                <span class="n">client</span><span class="o">.</span><span class="n">delete_namespace</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k8s_namespace</span><span class="p">)</span>

    <span class="c1"># overload_inject_start_client_flow</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">asyncio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>
        <span class="n">https</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">protocol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'GRPC'</span><span class="p">,</span>
        <span class="n">proxy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">"""Create a Flow. Flow is how Jina streamlines and scales Executors. This overloaded method provides arguments from `jina client` CLI.</span>

<span class="sd">        :param asyncio: If set, then the input and output of this Client work in an asynchronous manner.</span>
<span class="sd">        :param host: The host address of the runtime, by default it is 0.0.0.0.</span>
<span class="sd">        :param https: If set, connect to gateway using https</span>
<span class="sd">        :param port: The port of the Gateway, which the client should connect to.</span>
<span class="sd">        :param protocol: Communication protocol between server and client.</span>
<span class="sd">        :param proxy: If set, respect the http_proxy and https_proxy environment variables. otherwise, it will unset these proxy variables before start. gRPC seems to prefer no proxy</span>

<span class="sd">        .. # noqa: DAR202</span>
<span class="sd">        .. # noqa: DAR101</span>
<span class="sd">        .. # noqa: DAR003</span>
<span class="sd">        """</span>

    <span class="c1"># overload_inject_end_client_flow</span>

    <span class="c1"># overload_inject_start_gateway_flow</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">compress</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'NONE'</span><span class="p">,</span>
        <span class="n">compress_min_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="n">compress_min_ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span>
        <span class="n">cors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ctrl_with_ipc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">daemon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">default_swagger_ui</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">expose_endpoints</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">expose_public</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>
        <span class="n">host_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>
        <span class="n">host_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>
        <span class="n">hosts_in_connect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">log_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">memory_hwm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'gateway'</span><span class="p">,</span>
        <span class="n">native</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">no_crud_endpoints</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">no_debug_endpoints</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">on_error_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'IGNORE'</span><span class="p">,</span>
        <span class="n">port_ctrl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port_expose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prefetch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">protocol</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'GRPC'</span><span class="p">,</span>
        <span class="n">proxy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">py_modules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quiet</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">quiet_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">replicas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">runs_in_docker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">runtime_backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'PROCESS'</span><span class="p">,</span>
        <span class="n">runtime_cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'GRPCRuntime'</span><span class="p">,</span>
        <span class="n">shards</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">socket_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'PULL_CONNECT'</span><span class="p">,</span>
        <span class="n">socket_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'PUSH_CONNECT'</span><span class="p">,</span>
        <span class="n">ssh_keyfile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ssh_password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ssh_server</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">static_routing_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout_ctrl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
        <span class="n">timeout_ready</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600000</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'BaseExecutor'</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">'BaseExecutor'</span><span class="p">,</span>
        <span class="n">uses_metas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses_requests</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses_with</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uvicorn_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workspace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zmq_identity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">"""Create a Flow. Flow is how Jina streamlines and scales Executors. This overloaded method provides arguments from `jina gateway` CLI.</span>

<span class="sd">        :param compress: The compress algorithm used over the entire Flow.</span>

<span class="sd">              Note that this is not necessarily effective,</span>
<span class="sd">              it depends on the settings of `--compress-min-bytes` and `compress-min-ratio`</span>
<span class="sd">        :param compress_min_bytes: The original message size must be larger than this number to trigger the compress algorithm, -1 means disable compression.</span>
<span class="sd">        :param compress_min_ratio: The compression ratio (uncompressed_size/compressed_size) must be higher than this number to trigger the compress algorithm.</span>
<span class="sd">        :param cors: If set, a CORS middleware is added to FastAPI frontend to allow cross-origin access.</span>
<span class="sd">        :param ctrl_with_ipc: If set, use ipc protocol for control socket</span>
<span class="sd">        :param daemon: The Pea attempts to terminate all of its Runtime child processes/threads on existing. setting it to true basically tell the Pea do not wait on the Runtime when closing</span>
<span class="sd">        :param default_swagger_ui: If set, the default swagger ui is used for `/docs` endpoint.</span>
<span class="sd">        :param description: The description of this HTTP server. It will be used in automatics docs such as Swagger UI.</span>
<span class="sd">        :param env: The map of environment variables that are available inside runtime</span>
<span class="sd">        :param expose_endpoints: A JSON string that represents a map from executor endpoints (`@requests(on=...)`) to HTTP endpoints.</span>
<span class="sd">        :param expose_public: If set, expose the public IP address to remote when necessary, by default it exposesprivate IP address, which only allows accessing under the same network/subnet. Important to set this to true when the Pea will receive input connections from remote Peas</span>
<span class="sd">        :param host: The host address of the runtime, by default it is 0.0.0.0.</span>
<span class="sd">        :param host_in: The host address for input, by default it is 0.0.0.0</span>
<span class="sd">        :param host_out: The host address for output, by default it is 0.0.0.0</span>
<span class="sd">        :param hosts_in_connect: The host address for input, by default it is 0.0.0.0</span>
<span class="sd">        :param log_config: The YAML config of the logger used in this object.</span>
<span class="sd">        :param memory_hwm: The memory high watermark of this pod in Gigabytes, pod will restart when this is reached. -1 means no restriction</span>
<span class="sd">        :param name: The name of this object.</span>

<span class="sd">          This will be used in the following places:</span>
<span class="sd">          - how you refer to this object in Python/YAML/CLI</span>
<span class="sd">          - visualization</span>
<span class="sd">          - log message header</span>
<span class="sd">          - ...</span>

<span class="sd">          When not given, then the default naming strategy will apply.</span>
<span class="sd">        :param native: If set, only native Executors is allowed, and the Executor is always run inside ZEDRuntime.</span>
<span class="sd">        :param no_crud_endpoints: If set, /index, /search, /update, /delete endpoints are removed from HTTP interface.</span>

<span class="sd">                  Any executor that has `@requests(on=...)` bind with those values will receive data requests.</span>
<span class="sd">        :param no_debug_endpoints: If set, /status /post endpoints are removed from HTTP interface.</span>
<span class="sd">        :param on_error_strategy: The skip strategy on exceptions.</span>

<span class="sd">          - IGNORE: Ignore it, keep running all Executors in the sequel flow</span>
<span class="sd">          - SKIP_HANDLE: Skip all Executors in the sequel, only `pre_hook` and `post_hook` are called</span>
<span class="sd">          - THROW_EARLY: Immediately throw the exception, the sequel flow will not be running at all</span>

<span class="sd">          Note, `IGNORE`, `SKIP_EXECUTOR` and `SKIP_HANDLE` do not guarantee the success execution in the sequel flow. If something</span>
<span class="sd">          is wrong in the upstream, it is hard to carry this exception and moving forward without any side-effect.</span>
<span class="sd">        :param port_ctrl: The port for controlling the runtime, default a random port between [49152, 65535]</span>
<span class="sd">        :param port_expose: The port that the gateway exposes for clients for GRPC connections.</span>
<span class="sd">        :param port_in: The port for input data, default a random port between [49152, 65535]</span>
<span class="sd">        :param port_out: The port for output data, default a random port between [49152, 65535]</span>
<span class="sd">        :param prefetch: Number of requests fetched from the client before feeding into the first Executor.</span>

<span class="sd">              Used to control the speed of data input into a Flow. 0 disables prefetch (disabled by default)</span>
<span class="sd">        :param protocol: Communication protocol between server and client.</span>
<span class="sd">        :param proxy: If set, respect the http_proxy and https_proxy environment variables. otherwise, it will unset these proxy variables before start. gRPC seems to prefer no proxy</span>
<span class="sd">        :param py_modules: The customized python modules need to be imported before loading the executor</span>

<span class="sd">          Note that the recommended way is to only import a single module - a simple python file, if your</span>
<span class="sd">          executor can be defined in a single file, or an ``__init__.py`` file if you have multiple files,</span>
<span class="sd">          which should be structured as a python package. For more details, please see the</span>
<span class="sd">          `Executor cookbook &lt;https://docs.jina.ai/fundamentals/executor/repository-structure/&gt;`__</span>
<span class="sd">        :param quiet: If set, then no log will be emitted from this object.</span>
<span class="sd">        :param quiet_error: If set, then exception stack information will not be added to the log</span>
<span class="sd">        :param replicas: The number of replicas in the pod, `port_in` and `port_out` will be set to random, and routers will be added automatically when necessary</span>
<span class="sd">        :param runs_in_docker: Informs a Pea that runs in a container. Important to properly set networking information</span>
<span class="sd">        :param runtime_backend: The parallel backend of the runtime inside the Pea</span>
<span class="sd">        :param runtime_cls: The runtime class to run inside the Pea</span>
<span class="sd">        :param shards: The number of shards in the pod running at the same time, `port_in` and `port_out` will be set to random, and routers will be added automatically when necessary. For more details check https://docs.jina.ai/fundamentals/flow/topology/</span>
<span class="sd">        :param socket_in: The socket type for input port</span>
<span class="sd">        :param socket_out: The socket type for output port</span>
<span class="sd">        :param ssh_keyfile: This specifies a key to be used in ssh login, default None. regular default ssh keys will be used without specifying this argument.</span>
<span class="sd">        :param ssh_password: The ssh password to the ssh server.</span>
<span class="sd">        :param ssh_server: The SSH server through which the tunnel will be created, can actually be a fully specified `user@server:port` ssh url.</span>
<span class="sd">        :param static_routing_table: Defines if the routing table should be pre computed by the Flow. In this case it is statically defined for each Pod and not send on every data request. Can not be used in combination with external pods</span>
<span class="sd">        :param timeout_ctrl: The timeout in milliseconds of the control request, -1 for waiting forever</span>
<span class="sd">        :param timeout_ready: The timeout in milliseconds of a Pea waits for the runtime to be ready, -1 for waiting forever</span>
<span class="sd">        :param title: The title of this HTTP server. It will be used in automatics docs such as Swagger UI.</span>
<span class="sd">        :param uses: The config of the executor, it could be one of the followings:</span>
<span class="sd">                  * an Executor YAML file (.yml, .yaml, .jaml)</span>
<span class="sd">                  * a Jina Hub Executor (must start with `jinahub://` or `jinahub+docker://`)</span>
<span class="sd">                  * a docker image (must start with `docker://`)</span>
<span class="sd">                  * the string literal of a YAML config (must start with `!` or `jtype: `)</span>
<span class="sd">                  * the string literal of a JSON config</span>

<span class="sd">                  When use it under Python, one can use the following values additionally:</span>
<span class="sd">                  - a Python dict that represents the config</span>
<span class="sd">                  - a text file stream has `.read()` interface</span>
<span class="sd">        :param uses_metas: Dictionary of keyword arguments that will override the `metas` configuration in `uses`</span>
<span class="sd">        :param uses_requests: Dictionary of keyword arguments that will override the `requests` configuration in `uses`</span>
<span class="sd">        :param uses_with: Dictionary of keyword arguments that will override the `with` configuration in `uses`</span>
<span class="sd">        :param uvicorn_kwargs: Dictionary of kwargs arguments that will be passed to Uvicorn server when starting the server</span>

<span class="sd">          More details can be found in Uvicorn docs: https://www.uvicorn.org/settings/</span>
<span class="sd">        :param workspace: The working directory for any IO operations in this object. If not set, then derive from its parent `workspace`.</span>
<span class="sd">        :param zmq_identity: The identity of a ZMQRuntime. It is used for unique socket identification towards other ZMQRuntimes.</span>

<span class="sd">        .. # noqa: DAR202</span>
<span class="sd">        .. # noqa: DAR101</span>
<span class="sd">        .. # noqa: DAR003</span>
<span class="sd">        """</span>

    <span class="c1"># overload_inject_end_gateway_flow</span>
    <span class="c1"># overload_inject_start_flow</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inspect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'COLLECT'</span><span class="p">,</span>
        <span class="n">log_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quiet</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">quiet_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">static_routing_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">uses</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workspace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'./'</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">"""Create a Flow. Flow is how Jina streamlines and scales Executors. This overloaded method provides arguments from `jina flow` CLI.</span>

<span class="sd">        :param env: The map of environment variables that are available inside runtime</span>
<span class="sd">        :param inspect: The strategy on those inspect pods in the flow.</span>

<span class="sd">              If `REMOVE` is given then all inspect pods are removed when building the flow.</span>
<span class="sd">        :param log_config: The YAML config of the logger used in this object.</span>
<span class="sd">        :param name: The name of this object.</span>

<span class="sd">          This will be used in the following places:</span>
<span class="sd">          - how you refer to this object in Python/YAML/CLI</span>
<span class="sd">          - visualization</span>
<span class="sd">          - log message header</span>
<span class="sd">          - ...</span>

<span class="sd">          When not given, then the default naming strategy will apply.</span>
<span class="sd">        :param quiet: If set, then no log will be emitted from this object.</span>
<span class="sd">        :param quiet_error: If set, then exception stack information will not be added to the log</span>
<span class="sd">        :param static_routing_table: Defines if the routing table should be pre computed by the Flow. In this case it is statically defined for each Pod and not send on every data request. Can not be used in combination with external pods</span>
<span class="sd">        :param uses: The YAML file represents a flow</span>
<span class="sd">        :param workspace: The working directory for any IO operations in this object. If not set, then derive from its parent `workspace`.</span>

<span class="sd">        .. # noqa: DAR202</span>
<span class="sd">        .. # noqa: DAR101</span>
<span class="sd">        .. # noqa: DAR003</span>
<span class="sd">        """</span>

    <span class="c1"># overload_inject_end_flow</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">'argparse.Namespace'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="s1">'1'</span>  <span class="c1">#: YAML version number, this will be later overridden if YAML config says the other way</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>  <span class="c1"># type: Dict[str, Pod]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inspect_pods</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, str]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints_mapping</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Dict]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_changed_pod</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">GATEWAY_NAME</span>
        <span class="p">]</span>  <span class="c1">#: default first pod is gateway, will add when build()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">k8s_infrastructure_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">infrastructure</span> <span class="o">==</span> <span class="n">InfrastructureType</span><span class="o">.</span><span class="n">K8S</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k8s_infrastructure_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FlowK8sInfraResourcesManager</span><span class="p">(</span>
                <span class="n">k8s_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">k8s_custom_resource_dir</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">'k8s_custom_resource_dir'</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">JinaLogger</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">JinaLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..parsers.flow</span> <span class="kn">import</span> <span class="n">set_flow_parser</span>
        <span class="kn">from</span> <span class="nn">..helper</span> <span class="kn">import</span> <span class="n">ArgNamespace</span>

        <span class="n">_flow_parser</span> <span class="o">=</span> <span class="n">set_flow_parser</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">ArgNamespace</span><span class="o">.</span><span class="n">kwargs2namespace</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">,</span> <span class="n">_flow_parser</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fallback_parsers</span><span class="o">=</span><span class="n">FALLBACK_PARSERS</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="c1"># common args should be the ones that can not be parsed by _flow_parser</span>
        <span class="n">known_keys</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">known_keys</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">ArgNamespace</span><span class="o">.</span><span class="n">get_non_defaults_args</span><span class="p">(</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">_flow_parser</span>
        <span class="p">)</span>  <span class="c1">#: for yaml dump</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'asyncio'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">AsyncPostMixin</span>
        <span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.asyncio</span> <span class="kn">import</span> <span class="n">AsyncFlow</span>

            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">AsyncFlow</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parse_endpoints</span><span class="p">(</span><span class="n">op_flow</span><span class="p">,</span> <span class="n">pod_name</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">connect_to_last_pod</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">:</span>
        <span class="c1"># parsing needs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="p">[</span><span class="n">endpoint</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_last_changed_pod</span> <span class="ow">and</span> <span class="n">connect_to_last_pod</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="p">[</span><span class="n">op_flow</span><span class="o">.</span><span class="n">last_pod</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">endpoint</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">pod_name</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FlowTopologyError</span><span class="p">(</span>
                        <span class="s1">'the income/output of a pod can not be itself'</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'endpoint=</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s1"> is not parsable'</span><span class="p">)</span>

        <span class="c1"># if an endpoint is being inspected, then replace it with inspected Pod</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">op_flow</span><span class="o">.</span><span class="n">_inspect_pods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span> <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">endpoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">endpoint</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_pod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Last pod</span>


<span class="sd">        .. # noqa: DAR401</span>


<span class="sd">        .. # noqa: DAR201</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_changed_pod</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@last_pod</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">last_pod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Set a Pod as the last Pod in the Flow, useful when modifying the Flow.</span>


<span class="sd">        .. # noqa: DAR401</span>
<span class="sd">        :param name: the name of the existing Pod</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FlowMissingPodError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> can not be found in this Flow'</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_changed_pod</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_pod</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_changed_pod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># graph is now changed so we need to</span>
        <span class="c1"># reset the build level to the lowest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span>

    <span class="nd">@allowed_levels</span><span class="p">([</span><span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">_add_gateway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">needs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">GATEWAY_NAME</span><span class="p">,</span>
                <span class="n">ctrl_with_ipc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># otherwise ctrl port would be conflicted</span>
                <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                <span class="n">protocol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span>
                <span class="n">port_expose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port_expose</span><span class="p">,</span>
                <span class="n">pod_role</span><span class="o">=</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">GATEWAY</span><span class="p">,</span>
                <span class="n">expose_endpoints</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endpoints_mapping</span><span class="p">),</span>
                <span class="n">k8s_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">ArgNamespace</span><span class="o">.</span><span class="n">kwargs2namespace</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">set_gateway_parser</span><span class="p">())</span>
        <span class="n">args</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span>
        <span class="n">args</span><span class="o">.</span><span class="n">connect_to_predecessor</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">args</span><span class="o">.</span><span class="n">noblock_on_start</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">PodFactory</span><span class="o">.</span><span class="n">build_pod</span><span class="p">(</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">needs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">infrastructure</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Flow.needs"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.needs">[docs]</a>    <span class="nd">@allowed_levels</span><span class="p">([</span><span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">needs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">needs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'joiner'</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Add a blocker to the Flow, wait until all peas defined in **needs** completed.</span>


<span class="sd">        .. # noqa: DAR401</span>
<span class="sd">        :param needs: list of service names to wait</span>
<span class="sd">        :param name: the name of this joiner, by default is ``joiner``</span>
<span class="sd">        :param args: additional positional arguments forwarded to the add function</span>
<span class="sd">        :param kwargs: additional key value arguments forwarded to the add function</span>
<span class="sd">        :return: the modified Flow</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">needs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FlowTopologyError</span><span class="p">(</span>
                <span class="s1">'no need to wait for a single service, need len(needs) &gt; 1'</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="n">needs</span><span class="p">,</span> <span class="n">pod_role</span><span class="o">=</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">JOIN</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Flow.needs_all"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.needs_all">[docs]</a>    <span class="k">def</span> <span class="nf">needs_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'joiner'</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Collect all hanging Pods so far and add a blocker to the Flow; wait until all handing peas completed.</span>

<span class="sd">        :param name: the name of this joiner (default is ``joiner``)</span>
<span class="sd">        :param args: additional positional arguments which are forwarded to the add and needs function</span>
<span class="sd">        :param kwargs: additional key value arguments which are forwarded to the add and needs function</span>
<span class="sd">        :return: the modified Flow</span>
<span class="sd">        """</span>
        <span class="n">needs</span> <span class="o">=</span> <span class="n">_hanging_pods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">needs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="n">needs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">needs</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="n">needs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1"># overload_inject_start_pod</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">connect_to_predecessor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ctrl_with_ipc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">daemon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">docker_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">entrypoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">expose_public</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">external</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">force_update</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">gpus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>
        <span class="n">host_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>
        <span class="n">host_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0.0.0.0'</span><span class="p">,</span>
        <span class="n">hosts_in_connect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">install_requirements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">log_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">memory_hwm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">native</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">on_error_strategy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'IGNORE'</span><span class="p">,</span>
        <span class="n">peas_hosts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">polling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'ANY'</span><span class="p">,</span>
        <span class="n">port_ctrl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port_jinad</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>
        <span class="n">port_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pull_latest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">py_modules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quiet</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">quiet_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">quiet_remote_logs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">replicas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">runs_in_docker</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">runtime_backend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'PROCESS'</span><span class="p">,</span>
        <span class="n">runtime_cls</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'ZEDRuntime'</span><span class="p">,</span>
        <span class="n">scheduling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'LOAD_BALANCE'</span><span class="p">,</span>
        <span class="n">shards</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">socket_in</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'PULL_BIND'</span><span class="p">,</span>
        <span class="n">socket_out</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'PUSH_BIND'</span><span class="p">,</span>
        <span class="n">ssh_keyfile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ssh_password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ssh_server</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">static_routing_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout_ctrl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
        <span class="n">timeout_ready</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">600000</span><span class="p">,</span>
        <span class="n">upload_files</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'BaseExecutor'</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">'BaseExecutor'</span><span class="p">,</span>
        <span class="n">uses_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'BaseExecutor'</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses_before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s1">'BaseExecutor'</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses_metas</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses_requests</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">uses_with</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">volumes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workspace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zmq_identity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s1">'Flow'</span><span class="p">,</span> <span class="s1">'AsyncFlow'</span><span class="p">]:</span>
        <span class="sd">"""Add an Executor to the current Flow object.</span>

<span class="sd">        :param connect_to_predecessor: The head Pea of this Pod will connect to the TailPea of the predecessor Pod.</span>
<span class="sd">        :param ctrl_with_ipc: If set, use ipc protocol for control socket</span>
<span class="sd">        :param daemon: The Pea attempts to terminate all of its Runtime child processes/threads on existing. setting it to true basically tell the Pea do not wait on the Runtime when closing</span>
<span class="sd">        :param docker_kwargs: Dictionary of kwargs arguments that will be passed to Docker SDK when starting the docker '</span>
<span class="sd">          container.</span>

<span class="sd">          More details can be found in the Docker SDK docs:  https://docker-py.readthedocs.io/en/stable/</span>
<span class="sd">        :param entrypoint: The entrypoint command overrides the ENTRYPOINT in Docker image. when not set then the Docker image ENTRYPOINT takes effective.</span>
<span class="sd">        :param env: The map of environment variables that are available inside runtime</span>
<span class="sd">        :param expose_public: If set, expose the public IP address to remote when necessary, by default it exposesprivate IP address, which only allows accessing under the same network/subnet. Important to set this to true when the Pea will receive input connections from remote Peas</span>
<span class="sd">        :param external: The Pod will be considered an external Pod that has been started independently from the Flow.This Pod will not be context managed by the Flow.</span>
<span class="sd">        :param force_update: If set, always pull the latest Hub Executor bundle even it exists on local</span>
<span class="sd">        :param gpus: This argument allows dockerized Jina executor discover local gpu devices.</span>

<span class="sd">              Note,</span>
<span class="sd">              - To access all gpus, use `--gpus all`.</span>
<span class="sd">              - To access multiple gpus, e.g. make use of 2 gpus, use `--gpus 2`.</span>
<span class="sd">              - To access specified gpus based on device id, use `--gpus device=[YOUR-GPU-DEVICE-ID]`</span>
<span class="sd">              - To access specified gpus based on multiple device id, use `--gpus device=[YOUR-GPU-DEVICE-ID1],device=[YOUR-GPU-DEVICE-ID2]`</span>
<span class="sd">              - To specify more parameters, use `--gpus device=[YOUR-GPU-DEVICE-ID],runtime=nvidia,capabilities=display</span>
<span class="sd">        :param host: The host address of the runtime, by default it is 0.0.0.0.</span>
<span class="sd">        :param host_in: The host address for input, by default it is 0.0.0.0</span>
<span class="sd">        :param host_out: The host address for output, by default it is 0.0.0.0</span>
<span class="sd">        :param hosts_in_connect: The host address for input, by default it is 0.0.0.0</span>
<span class="sd">        :param install_requirements: If set, install `requirements.txt` in the Hub Executor bundle to local</span>
<span class="sd">        :param log_config: The YAML config of the logger used in this object.</span>
<span class="sd">        :param memory_hwm: The memory high watermark of this pod in Gigabytes, pod will restart when this is reached. -1 means no restriction</span>
<span class="sd">        :param name: The name of this object.</span>

<span class="sd">          This will be used in the following places:</span>
<span class="sd">          - how you refer to this object in Python/YAML/CLI</span>
<span class="sd">          - visualization</span>
<span class="sd">          - log message header</span>
<span class="sd">          - ...</span>

<span class="sd">          When not given, then the default naming strategy will apply.</span>
<span class="sd">        :param native: If set, only native Executors is allowed, and the Executor is always run inside ZEDRuntime.</span>
<span class="sd">        :param on_error_strategy: The skip strategy on exceptions.</span>

<span class="sd">          - IGNORE: Ignore it, keep running all Executors in the sequel flow</span>
<span class="sd">          - SKIP_HANDLE: Skip all Executors in the sequel, only `pre_hook` and `post_hook` are called</span>
<span class="sd">          - THROW_EARLY: Immediately throw the exception, the sequel flow will not be running at all</span>

<span class="sd">          Note, `IGNORE`, `SKIP_EXECUTOR` and `SKIP_HANDLE` do not guarantee the success execution in the sequel flow. If something</span>
<span class="sd">          is wrong in the upstream, it is hard to carry this exception and moving forward without any side-effect.</span>
<span class="sd">        :param peas_hosts: The hosts of the peas when shards greater than 1.</span>
<span class="sd">                  Peas will be evenly distributed among the hosts. By default,</span>
<span class="sd">                  peas are running on host provided by the argument ``host``</span>
<span class="sd">        :param polling: The polling strategy of the Pod (when `shards&gt;1`)</span>
<span class="sd">          - ANY: only one (whoever is idle) Pea polls the message</span>
<span class="sd">          - ALL: all Peas poll the message (like a broadcast)</span>
<span class="sd">        :param port_ctrl: The port for controlling the runtime, default a random port between [49152, 65535]</span>
<span class="sd">        :param port_in: The port for input data, default a random port between [49152, 65535]</span>
<span class="sd">        :param port_jinad: The port of the remote machine for usage with JinaD.</span>
<span class="sd">        :param port_out: The port for output data, default a random port between [49152, 65535]</span>
<span class="sd">        :param pull_latest: Pull the latest image before running</span>
<span class="sd">        :param py_modules: The customized python modules need to be imported before loading the executor</span>

<span class="sd">          Note that the recommended way is to only import a single module - a simple python file, if your</span>
<span class="sd">          executor can be defined in a single file, or an ``__init__.py`` file if you have multiple files,</span>
<span class="sd">          which should be structured as a python package. For more details, please see the</span>
<span class="sd">          `Executor cookbook &lt;https://docs.jina.ai/fundamentals/executor/repository-structure/&gt;`__</span>
<span class="sd">        :param quiet: If set, then no log will be emitted from this object.</span>
<span class="sd">        :param quiet_error: If set, then exception stack information will not be added to the log</span>
<span class="sd">        :param quiet_remote_logs: Do not display the streaming of remote logs on local console</span>
<span class="sd">        :param replicas: The number of replicas in the pod, `port_in` and `port_out` will be set to random, and routers will be added automatically when necessary</span>
<span class="sd">        :param runs_in_docker: Informs a Pea that runs in a container. Important to properly set networking information</span>
<span class="sd">        :param runtime_backend: The parallel backend of the runtime inside the Pea</span>
<span class="sd">        :param runtime_cls: The runtime class to run inside the Pea</span>
<span class="sd">        :param scheduling: The strategy of scheduling workload among Peas</span>
<span class="sd">        :param shards: The number of shards in the pod running at the same time, `port_in` and `port_out` will be set to random, and routers will be added automatically when necessary. For more details check https://docs.jina.ai/fundamentals/flow/topology/</span>
<span class="sd">        :param socket_in: The socket type for input port</span>
<span class="sd">        :param socket_out: The socket type for output port</span>
<span class="sd">        :param ssh_keyfile: This specifies a key to be used in ssh login, default None. regular default ssh keys will be used without specifying this argument.</span>
<span class="sd">        :param ssh_password: The ssh password to the ssh server.</span>
<span class="sd">        :param ssh_server: The SSH server through which the tunnel will be created, can actually be a fully specified `user@server:port` ssh url.</span>
<span class="sd">        :param static_routing_table: Defines if the routing table should be pre computed by the Flow. In this case it is statically defined for each Pod and not send on every data request. Can not be used in combination with external pods</span>
<span class="sd">        :param timeout_ctrl: The timeout in milliseconds of the control request, -1 for waiting forever</span>
<span class="sd">        :param timeout_ready: The timeout in milliseconds of a Pea waits for the runtime to be ready, -1 for waiting forever</span>
<span class="sd">        :param upload_files: The files on the host to be uploaded to the remote</span>
<span class="sd">          workspace. This can be useful when your Pod has more</span>
<span class="sd">          file dependencies beyond a single YAML file, e.g.</span>
<span class="sd">          Python files, data files.</span>

<span class="sd">          Note,</span>
<span class="sd">          - currently only flatten structure is supported, which means if you upload `[./foo/a.py, ./foo/b.pp, ./bar/c.yml]`, then they will be put under the _same_ workspace on the remote, losing all hierarchies.</span>
<span class="sd">          - by default, `--uses` YAML file is always uploaded.</span>
<span class="sd">          - uploaded files are by default isolated across the runs. To ensure files are submitted to the same workspace across different runs, use `--workspace-id` to specify the workspace.</span>
<span class="sd">        :param uses: The config of the executor, it could be one of the followings:</span>
<span class="sd">                  * an Executor YAML file (.yml, .yaml, .jaml)</span>
<span class="sd">                  * a Jina Hub Executor (must start with `jinahub://` or `jinahub+docker://`)</span>
<span class="sd">                  * a docker image (must start with `docker://`)</span>
<span class="sd">                  * the string literal of a YAML config (must start with `!` or `jtype: `)</span>
<span class="sd">                  * the string literal of a JSON config</span>

<span class="sd">                  When use it under Python, one can use the following values additionally:</span>
<span class="sd">                  - a Python dict that represents the config</span>
<span class="sd">                  - a text file stream has `.read()` interface</span>
<span class="sd">        :param uses_after: The executor attached after the Peas described by --uses, typically used for receiving from all shards, accepted type follows `--uses`</span>
<span class="sd">        :param uses_before: The executor attached after the Peas described by --uses, typically before sending to all shards, accepted type follows `--uses`</span>
<span class="sd">        :param uses_metas: Dictionary of keyword arguments that will override the `metas` configuration in `uses`</span>
<span class="sd">        :param uses_requests: Dictionary of keyword arguments that will override the `requests` configuration in `uses`</span>
<span class="sd">        :param uses_with: Dictionary of keyword arguments that will override the `with` configuration in `uses`</span>
<span class="sd">        :param volumes: The path on the host to be mounted inside the container.</span>

<span class="sd">          Note,</span>
<span class="sd">          - If separated by `:`, then the first part will be considered as the local host path and the second part is the path in the container system.</span>
<span class="sd">          - If no split provided, then the basename of that directory will be mounted into container's root path, e.g. `--volumes="/user/test/my-workspace"` will be mounted into `/my-workspace` inside the container.</span>
<span class="sd">          - All volumes are mounted with read-write mode.</span>
<span class="sd">        :param workspace: The working directory for any IO operations in this object. If not set, then derive from its parent `workspace`.</span>
<span class="sd">        :param zmq_identity: The identity of a ZMQRuntime. It is used for unique socket identification towards other ZMQRuntimes.</span>
<span class="sd">        :return: a (new) Flow object with modification</span>

<span class="sd">        .. # noqa: DAR202</span>
<span class="sd">        .. # noqa: DAR101</span>
<span class="sd">        .. # noqa: DAR003</span>
<span class="sd">        """</span>

    <span class="c1"># overload_inject_end_pod</span>
<div class="viewcode-block" id="Flow.add"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.add">[docs]</a>    <span class="nd">@allowed_levels</span><span class="p">([</span><span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">needs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">copy_flow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pod_role</span><span class="p">:</span> <span class="s1">'PodRoleType'</span> <span class="o">=</span> <span class="n">PodRoleType</span><span class="o">.</span><span class="n">POD</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Add a Pod to the current Flow object and return the new modified Flow object.</span>
<span class="sd">        The attribute of the Pod can be later changed with :py:meth:`set` or deleted with :py:meth:`remove`</span>

<span class="sd">        .. # noqa: DAR401</span>
<span class="sd">        :param needs: the name of the Pod(s) that this Pod receives data from.</span>
<span class="sd">                           One can also use 'gateway' to indicate the connection with the gateway.</span>
<span class="sd">        :param pod_role: the role of the Pod, used for visualization and route planning</span>
<span class="sd">        :param copy_flow: when set to true, then always copy the current Flow and do the modification on top of it then return, otherwise, do in-line modification</span>
<span class="sd">        :param kwargs: other keyword-value arguments that the Pod CLI supports</span>
<span class="sd">        :return: a (new) Flow object with modification</span>
<span class="sd">        """</span>
        <span class="n">op_flow</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">copy_flow</span> <span class="k">else</span> <span class="bp">self</span>

        <span class="c1"># pod naming logic</span>
        <span class="n">pod_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pod_name</span> <span class="ow">in</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">:</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}{</span><span class="nb">len</span><span class="p">(</span><span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s1">" is used in this Flow already! renamed it to "</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s1">"'</span>
            <span class="p">)</span>
            <span class="n">pod_name</span> <span class="o">=</span> <span class="n">new_name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pod_name</span><span class="p">:</span>
            <span class="n">pod_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'executor</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pod_name</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">():</span>
            <span class="c1"># hyphen - can not be used in the name</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'name: </span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s1"> is invalid, please follow the python variable name conventions'</span>
            <span class="p">)</span>

        <span class="c1"># needs logic</span>
        <span class="n">needs</span> <span class="o">=</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_parse_endpoints</span><span class="p">(</span>
            <span class="n">op_flow</span><span class="p">,</span> <span class="n">pod_name</span><span class="p">,</span> <span class="n">needs</span><span class="p">,</span> <span class="n">connect_to_last_pod</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># set the kwargs inherit from `Flow(kwargs1=..., kwargs2=)`</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># check if host is set to remote:port</span>
        <span class="k">if</span> <span class="s1">'host'</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_regex_port</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">'host'</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'host'</span><span class="p">,</span> <span class="n">__default_host__</span><span class="p">)</span> <span class="o">!=</span> <span class="n">__default_host__</span>
                <span class="ow">and</span> <span class="n">m</span>
                <span class="ow">and</span> <span class="s1">'port_jinad'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span>
            <span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">'port_jinad'</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">'host'</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># update kwargs of this Pod</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pod_name</span><span class="p">,</span> <span class="n">pod_role</span><span class="o">=</span><span class="n">pod_role</span><span class="p">,</span> <span class="n">num_part</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">needs</span><span class="p">)))</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">set_pod_parser</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pod_role</span> <span class="o">==</span> <span class="n">PodRoleType</span><span class="o">.</span><span class="n">GATEWAY</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">set_gateway_parser</span><span class="p">()</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">ArgNamespace</span><span class="o">.</span><span class="n">kwargs2namespace</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fallback_parsers</span><span class="o">=</span><span class="n">FALLBACK_PARSERS</span>
        <span class="p">)</span>

        <span class="c1"># grpc data runtime does not support sharding at the moment</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">grpc_data_requests</span>
            <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'shards'</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'shards'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">infrastructure</span> <span class="o">!=</span> <span class="n">InfrastructureType</span><span class="o">.</span><span class="n">K8S</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"GRPC data runtime does not support sharding"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">grpc_data_requests</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">runtime_cls</span> <span class="o">==</span> <span class="s1">'ZEDRuntime'</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">runtime_cls</span> <span class="o">=</span> <span class="s1">'GRPCDataRuntime'</span>

        <span class="c1"># pod workspace if not set then derive from flow workspace</span>
        <span class="n">args</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">workspace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace</span><span class="p">)</span>

        <span class="n">args</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">k8s_namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span>
        <span class="n">args</span><span class="o">.</span><span class="n">noblock_on_start</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">args</span><span class="o">.</span><span class="n">extra_search_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">extra_search_paths</span>
        <span class="n">args</span><span class="o">.</span><span class="n">zmq_identity</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># BACKWARDS COMPATIBILITY:</span>
        <span class="c1"># We assume that this is used in a search Flow if replicas and shards are used</span>
        <span class="c1"># Thus the polling type should be all</span>
        <span class="c1"># But dont override any user provided polling</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">replicas</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">shards</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">'polling'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">polling</span> <span class="o">=</span> <span class="n">PollingType</span><span class="o">.</span><span class="n">ALL</span>

        <span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">PodFactory</span><span class="o">.</span><span class="n">build_pod</span><span class="p">(</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">needs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">infrastructure</span>
        <span class="p">)</span>

        <span class="n">op_flow</span><span class="o">.</span><span class="n">last_pod</span> <span class="o">=</span> <span class="n">pod_name</span>

        <span class="k">return</span> <span class="n">op_flow</span></div>

<div class="viewcode-block" id="Flow.inspect"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.inspect">[docs]</a>    <span class="nd">@allowed_levels</span><span class="p">([</span><span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'inspect'</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">"""Add an inspection on the last changed Pod in the Flow</span>

<span class="sd">        Internally, it adds two Pods to the Flow. But don't worry, the overhead is minimized and you</span>
<span class="sd">        can remove them by simply using `Flow(inspect=FlowInspectType.REMOVE)` before using the Flow.</span>

<span class="sd">        .. highlight:: bash</span>
<span class="sd">        .. code-block:: bash</span>

<span class="sd">            Flow -- PUB-SUB -- BasePod(_pass) -- Flow</span>
<span class="sd">                    |</span>
<span class="sd">                    -- PUB-SUB -- InspectPod (Hanging)</span>

<span class="sd">        In this way, :class:`InspectPod` looks like a simple ``_pass`` from outside and</span>
<span class="sd">        does not introduce side-effects (e.g. changing the socket type) to the original Flow.</span>
<span class="sd">        The original incoming and outgoing socket types are preserved.</span>

<span class="sd">        This function is very handy for introducing an Evaluator into the Flow.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            :meth:`gather_inspect`</span>

<span class="sd">        :param name: name of the Pod</span>
<span class="sd">        :param args: args for .add()</span>
<span class="sd">        :param kwargs: kwargs for .add()</span>
<span class="sd">        :return: the new instance of the Flow</span>
<span class="sd">        """</span>
        <span class="n">_last_pod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_pod</span>
        <span class="n">op_flow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="n">_last_pod</span><span class="p">,</span> <span class="n">pod_role</span><span class="o">=</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">INSPECT</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="c1"># now remove uses and add an auxiliary Pod</span>
        <span class="k">if</span> <span class="s1">'uses'</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'uses'</span><span class="p">)</span>
        <span class="n">op_flow</span> <span class="o">=</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">'_aux_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
            <span class="n">needs</span><span class="o">=</span><span class="n">_last_pod</span><span class="p">,</span>
            <span class="n">pod_role</span><span class="o">=</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">INSPECT_AUX_PASS</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># register any future connection to _last_pod by the auxiliary Pod</span>
        <span class="n">op_flow</span><span class="o">.</span><span class="n">_inspect_pods</span><span class="p">[</span><span class="n">_last_pod</span><span class="p">]</span> <span class="o">=</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">last_pod</span>

        <span class="k">return</span> <span class="n">op_flow</span></div>

<div class="viewcode-block" id="Flow.gather_inspect"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.gather_inspect">[docs]</a>    <span class="nd">@allowed_levels</span><span class="p">([</span><span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">gather_inspect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'gather_inspect'</span><span class="p">,</span>
        <span class="n">include_last_pod</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">"""Gather all inspect Pods output into one Pod. When the Flow has no inspect Pod then the Flow itself</span>
<span class="sd">        is returned.</span>

<span class="sd">        .. note::</span>

<span class="sd">            If ``--no-inspect`` is **not** given, then :meth:`gather_inspect` is auto called before :meth:`build`. So</span>
<span class="sd">            in general you don't need to manually call :meth:`gather_inspect`.</span>

<span class="sd">        :param name: the name of the gather Pod</span>
<span class="sd">        :param include_last_pod: if to include the last modified Pod in the Flow</span>
<span class="sd">        :param args: args for .add()</span>
<span class="sd">        :param kwargs: kwargs for .add()</span>
<span class="sd">        :return: the modified Flow or the copy of it</span>


<span class="sd">        .. seealso::</span>

<span class="sd">            :meth:`inspect`</span>

<span class="sd">        """</span>
        <span class="n">needs</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">PodRoleType</span><span class="o">.</span><span class="n">INSPECT</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">needs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_last_pod</span><span class="p">:</span>
                <span class="n">needs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_pod</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">needs</span><span class="o">=</span><span class="n">needs</span><span class="p">,</span>
                <span class="n">pod_role</span><span class="o">=</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">JOIN_INSPECT</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no inspect node is in the graph, return the current graph</span>
            <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_get_gateway_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">gateway_pod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">GATEWAY_NAME</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s1">'host'</span><span class="p">:</span> <span class="n">gateway_pod</span><span class="o">.</span><span class="n">head_host</span><span class="p">,</span>
                <span class="s1">'port'</span><span class="p">:</span> <span class="n">gateway_pod</span><span class="o">.</span><span class="n">head_port_in</span><span class="p">,</span>
                <span class="s1">'expected_parts'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># TODO needs to be refactored - deployment should not be a dictionary. Related Ticket:</span>
    <span class="c1">#  https://github.com/jina-ai/jina/issues/3280</span>
    <span class="k">def</span> <span class="nf">_get_routing_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RoutingTable</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">RoutingTable</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pod_id</span><span class="p">,</span> <span class="n">pod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pod_id</span> <span class="o">==</span> <span class="n">GATEWAY_NAME</span><span class="p">:</span>
                <span class="n">deployment</span> <span class="o">=</span> <span class="n">pod</span><span class="o">.</span><span class="n">deployments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">graph</span><span class="o">.</span><span class="n">add_pod</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'start-</span><span class="si">{</span><span class="n">GATEWAY_NAME</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_host'</span><span class="p">],</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_port_in'</span><span class="p">],</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'tail_port_out'</span><span class="p">],</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_zmq_identity'</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_pod</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'end-</span><span class="si">{</span><span class="n">GATEWAY_NAME</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_host'</span><span class="p">],</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_port_in'</span><span class="p">],</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'tail_port_out'</span><span class="p">],</span>
                    <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_zmq_identity'</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">deployment</span> <span class="ow">in</span> <span class="n">pod</span><span class="o">.</span><span class="n">deployments</span><span class="p">:</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_pod</span><span class="p">(</span>
                        <span class="n">deployment</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
                        <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_host'</span><span class="p">],</span>
                        <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_port_in'</span><span class="p">],</span>
                        <span class="n">deployment</span><span class="p">[</span><span class="s1">'tail_port_out'</span><span class="p">],</span>
                        <span class="n">deployment</span><span class="p">[</span><span class="s1">'head_zmq_identity'</span><span class="p">],</span>
                    <span class="p">)</span>

        <span class="k">for</span> <span class="n">end</span><span class="p">,</span> <span class="n">pod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="n">GATEWAY_NAME</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'end-</span><span class="si">{</span><span class="n">GATEWAY_NAME</span><span class="si">}</span><span class="s1">'</span>

            <span class="k">if</span> <span class="n">pod</span><span class="o">.</span><span class="n">head_args</span><span class="o">.</span><span class="n">hosts_in_connect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pod</span><span class="o">.</span><span class="n">head_args</span><span class="o">.</span><span class="n">hosts_in_connect</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pod</span><span class="p">,</span> <span class="n">K8sPod</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">..peapods.pods.k8slib</span> <span class="kn">import</span> <span class="n">kubernetes_deployment</span>

                <span class="n">end</span> <span class="o">=</span> <span class="n">kubernetes_deployment</span><span class="o">.</span><span class="n">to_dns_name</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">pods</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="s1">'_head'</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pod</span><span class="p">,</span> <span class="n">K8sPod</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">..peapods.pods.k8slib</span> <span class="kn">import</span> <span class="n">kubernetes_deployment</span>

                <span class="n">end</span> <span class="o">=</span> <span class="n">kubernetes_deployment</span><span class="o">.</span><span class="n">to_dns_name</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">pod</span><span class="o">.</span><span class="n">needs</span><span class="p">:</span>
                <span class="n">start_pod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">GATEWAY_NAME</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'start-</span><span class="si">{</span><span class="n">GATEWAY_NAME</span><span class="si">}</span><span class="s1">'</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_pod</span><span class="p">,</span> <span class="n">K8sPod</span><span class="p">):</span>
                    <span class="kn">from</span> <span class="nn">..peapods.pods.k8slib</span> <span class="kn">import</span> <span class="n">kubernetes_deployment</span>

                    <span class="n">start</span> <span class="o">=</span> <span class="n">kubernetes_deployment</span><span class="o">.</span><span class="n">to_dns_name</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">pods</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="s1">'_tail'</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_pod</span><span class="p">,</span> <span class="n">K8sPod</span><span class="p">):</span>
                    <span class="kn">from</span> <span class="nn">..peapods.pods.k8slib</span> <span class="kn">import</span> <span class="n">kubernetes_deployment</span>

                    <span class="n">start</span> <span class="o">=</span> <span class="n">kubernetes_deployment</span><span class="o">.</span><span class="n">to_dns_name</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

                <span class="n">start_pod</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">_get_target_pod</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pod</span><span class="o">.</span><span class="n">connect_to_predecessor</span> <span class="ow">or</span> <span class="n">is_remote_local_connection</span><span class="p">(</span>
                    <span class="n">start_pod</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">pod</span><span class="o">.</span><span class="n">head_host</span>
                <span class="p">):</span>
                    <span class="n">pod</span><span class="o">.</span><span class="n">head_args</span><span class="o">.</span><span class="n">hosts_in_connect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">graph</span><span class="o">.</span><span class="n">_get_target_pod</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">full_out_address</span>
                    <span class="p">)</span>

                    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="c1"># In case of sharding, the head and the tail pea have to be connected to the shards</span>
        <span class="k">for</span> <span class="n">end</span><span class="p">,</span> <span class="n">pod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pod</span><span class="o">.</span><span class="n">deployments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">deployments</span> <span class="o">=</span> <span class="n">pod</span><span class="o">.</span><span class="n">deployments</span>
                <span class="k">for</span> <span class="n">deployment</span> <span class="ow">in</span> <span class="n">deployments</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">deployments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'name'</span><span class="p">],</span> <span class="n">deployment</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">deployment</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span> <span class="n">deployments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'name'</span><span class="p">])</span>

        <span class="n">graph</span><span class="o">.</span><span class="n">active_pod</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'start-</span><span class="si">{</span><span class="n">GATEWAY_NAME</span><span class="si">}</span><span class="s1">'</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span> <span class="nf">_set_initial_dynamic_routing_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">routing_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_routing_table</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">routing_table</span><span class="o">.</span><span class="n">is_acyclic</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">RoutingTableCyclicError</span><span class="p">(</span>
                <span class="s1">'The routing graph has a cycle. This would result in an infinite loop. Fix your Flow setup.'</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">pod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">:</span>
            <span class="n">routing_table_copy</span> <span class="o">=</span> <span class="n">RoutingTable</span><span class="p">()</span>
            <span class="n">routing_table_copy</span><span class="o">.</span><span class="n">proto</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">routing_table</span><span class="o">.</span><span class="n">proto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span>
                <span class="n">pod</span>
            <span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">static_routing_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">static_routing_table</span>
            <span class="c1"># The gateway always needs the routing table to be set</span>
            <span class="k">if</span> <span class="n">pod</span> <span class="o">==</span> <span class="n">GATEWAY_NAME</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">routing_table</span> <span class="o">=</span> <span class="n">routing_table_copy</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="c1"># For other pods we only set it if we are told do so</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">static_routing_table</span><span class="p">:</span>
                <span class="n">routing_table_copy</span><span class="o">.</span><span class="n">active_pod</span> <span class="o">=</span> <span class="n">pod</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">routing_table</span> <span class="o">=</span> <span class="n">routing_table_copy</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="c1"># dynamic routing does not apply to shards in a CompoundPod, only its tail</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod</span><span class="p">],</span> <span class="n">CompoundPod</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod</span><span class="p">]</span><span class="o">.</span><span class="n">update_pea_args</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod</span><span class="p">]</span><span class="o">.</span><span class="n">tail_args</span><span class="o">.</span><span class="n">routing_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span>
                        <span class="n">pod</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">routing_table</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span>
                        <span class="n">pod</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">tail_args</span><span class="o">.</span><span class="n">static_routing_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">static_routing_table</span>

<div class="viewcode-block" id="Flow.build"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.build">[docs]</a>    <span class="nd">@allowed_levels</span><span class="p">([</span><span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy_flow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Build the current Flow and make it ready to use</span>

<span class="sd">        .. note::</span>

<span class="sd">            No need to manually call it since 0.0.8. When using Flow with the</span>
<span class="sd">            context manager, or using :meth:`start`, :meth:`build` will be invoked.</span>

<span class="sd">        :param copy_flow: when set to true, then always copy the current Flow and do the modification on top of it then return, otherwise, do in-line modification</span>
<span class="sd">        :return: the current Flow (by default)</span>

<span class="sd">        .. note::</span>
<span class="sd">            ``copy_flow=True`` is recommended if you are building the same Flow multiple times in a row. e.g.</span>

<span class="sd">            .. highlight:: python</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                f = Flow()</span>
<span class="sd">                with f:</span>
<span class="sd">                    f.index()</span>

<span class="sd">                with f.build(copy_flow=True) as fl:</span>
<span class="sd">                    fl.search()</span>


<span class="sd">        .. # noqa: DAR401</span>
<span class="sd">        """</span>

        <span class="n">op_flow</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">copy_flow</span> <span class="k">else</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">inspect</span> <span class="o">==</span> <span class="n">FlowInspectType</span><span class="o">.</span><span class="n">COLLECT</span><span class="p">:</span>
            <span class="n">op_flow</span><span class="o">.</span><span class="n">gather_inspect</span><span class="p">(</span><span class="n">copy_flow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">GATEWAY_NAME</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">:</span>
            <span class="n">op_flow</span><span class="o">.</span><span class="n">_add_gateway</span><span class="p">(</span><span class="n">needs</span><span class="o">=</span><span class="p">{</span><span class="n">op_flow</span><span class="o">.</span><span class="n">last_pod</span><span class="p">})</span>

        <span class="c1"># if set no_inspect then all inspect related nodes are removed</span>
        <span class="k">if</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">inspect</span> <span class="o">==</span> <span class="n">FlowInspectType</span><span class="o">.</span><span class="n">REMOVE</span><span class="p">:</span>
            <span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">is_inspect</span>
            <span class="p">}</span>
            <span class="n">reverse_inspect_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_inspect_pods</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">for</span> <span class="n">end</span><span class="p">,</span> <span class="n">pod</span> <span class="ow">in</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># if an endpoint is being inspected, then replace it with inspected Pod</span>
            <span class="c1"># but not those inspect related node</span>
            <span class="k">if</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">inspect</span><span class="o">.</span><span class="n">is_keep</span><span class="p">:</span>
                <span class="n">pod</span><span class="o">.</span><span class="n">needs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">ep</span> <span class="k">if</span> <span class="n">pod</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">is_inspect</span> <span class="k">else</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_inspect_pods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">pod</span><span class="o">.</span><span class="n">needs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pod</span><span class="o">.</span><span class="n">needs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">reverse_inspect_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">ep</span><span class="p">)</span> <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">pod</span><span class="o">.</span><span class="n">needs</span><span class="p">)</span>

        <span class="n">op_flow</span><span class="o">.</span><span class="n">_set_initial_dynamic_routing_table</span><span class="p">()</span>

        <span class="n">hanging_pods</span> <span class="o">=</span> <span class="n">_hanging_pods</span><span class="p">(</span><span class="n">op_flow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hanging_pods</span><span class="p">:</span>
            <span class="n">op_flow</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">hanging_pods</span><span class="si">}</span><span class="s1"> are hanging in this flow with no pod receiving from them, '</span>
                <span class="sa">f</span><span class="s1">'you may want to double check if it is intentional or some mistake'</span>
            <span class="p">)</span>
        <span class="n">op_flow</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span>
        <span class="k">return</span> <span class="n">op_flow</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""Builds the Flow</span>
<span class="sd">        :param args: args for build</span>
<span class="sd">        :param kwargs: kwargs for build</span>
<span class="sd">        :return: the built Flow</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">CatchAllCleanupContextManager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'_stop_event'</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span>

        <span class="c1"># unset all envs to avoid any side-effect</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">env</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># do not know why but removing these 2 lines make 2 tests fail</span>
        <span class="k">if</span> <span class="n">GATEWAY_NAME</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">GATEWAY_NAME</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">EMPTY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'Flow is closed!'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="Flow.start"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Start to run all Pods in this Flow.</span>

<span class="sd">        Remember to close the Flow with :meth:`close`.</span>

<span class="sd">        Note that this method has a timeout of ``timeout_ready`` set in CLI,</span>
<span class="sd">        which is inherited all the way from :class:`jina.peapods.peas.BasePea`</span>


<span class="sd">        .. # noqa: DAR401</span>

<span class="sd">        :return: this instance</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">copy_flow</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k8s_infrastructure_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k8s_infrastructure_manager</span><span class="p">)</span>

        <span class="c1"># set env only before the Pod get started</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">env</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">'external'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_until_all_ready</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">RUNNING</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_wait_until_all_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">_wait_ready</span><span class="p">(</span><span class="n">_pod_name</span><span class="p">,</span> <span class="n">_pod</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_pod</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">'external'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">_pod_name</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'pending'</span>
                    <span class="n">_pod</span><span class="o">.</span><span class="n">wait_start_success</span><span class="p">()</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">_pod_name</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'done'</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">_pod_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_polling_status</span><span class="p">():</span>
            <span class="n">spinner</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">''</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">num_all</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
                <span class="n">num_done</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">pendings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_k</span><span class="p">,</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">_v</span> <span class="o">==</span> <span class="s1">'pending'</span><span class="p">:</span>
                        <span class="n">pendings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_k</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">num_done</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\r</span><span class="si">{}</span><span class="se">\r</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">' '</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
                <span class="n">pending_str</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pendings</span><span class="p">)[:</span><span class="mi">50</span><span class="p">],</span> <span class="s1">'yellow'</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">colored</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">spinner</span><span class="p">),</span> <span class="s2">"green"</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">num_done</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">num_all</span><span class="si">}</span><span class="s1"> waiting </span><span class="si">{</span><span class="n">pending_str</span><span class="si">}</span><span class="s1"> to be ready...'</span>
                <span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">pendings</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\r</span><span class="si">{}</span><span class="se">\r</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">' '</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># kick off all pods wait-ready threads</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="n">_wait_ready</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">k</span><span class="p">,</span>
                    <span class="n">v</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># kick off spinner thread</span>
        <span class="n">t_m</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_polling_status</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">t_m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># kick off ip getter thread</span>
        <span class="n">addr_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">t_ip</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">infrastructure</span> <span class="o">!=</span> <span class="n">InfrastructureType</span><span class="o">.</span><span class="n">K8S</span><span class="p">:</span>
            <span class="n">t_ip</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_address_table</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">addr_table</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">t_ip</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">t_ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t_ip</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">t_m</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="n">error_pods</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="s1">'done'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">error_pods</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'Flow is aborted due to </span><span class="si">{</span><span class="n">error_pods</span><span class="si">}</span><span class="s1"> can not be started.'</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">RuntimeFailToStart</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">infrastructure</span> <span class="o">==</span> <span class="n">InfrastructureType</span><span class="o">.</span><span class="n">K8S</span><span class="p">:</span>
                <span class="n">success_msg</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="s1">' Kubernetes Flow is ready to use!'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success_msg</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="s1">' Flow is ready to use!'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">addr_table</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">success_msg</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">addr_table</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_pods</span><span class="si">}</span><span class="s1"> Pods (i.e. </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_peas</span><span class="si">}</span><span class="s1"> Peas) are running in this Flow'</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_pods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""Get the number of Pods in this Flow</span>


<span class="sd">        .. # noqa: DAR201"""</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_peas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""Get the number of peas (shards count) in this Flow</span>


<span class="sd">        .. # noqa: DAR201"""</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">num_peas</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">'Flow'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Compare the topology of a Flow with another Flow.</span>
<span class="sd">        Identification is defined by whether two flows share the same set of edges.</span>

<span class="sd">        :param other: the second Flow object</span>
<span class="sd">        :return: result of equality check</span>
<span class="sd">        """</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">op_flow</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">_build_level</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">op_flow_b</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">op_flow_b</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">other</span>

        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">_pod_nodes</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">_pod_nodes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'BaseClient'</span><span class="p">:</span>
        <span class="sd">"""Return a :class:`BaseClient` object attach to this Flow.</span>

<span class="sd">        .. # noqa: DAR201"""</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port_expose</span><span class="p">,</span>
            <span class="n">protocol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Client</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mermaid_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mermaid_graph</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sd">'''</span>
<span class="sd">            %%{init:{</span>
<span class="sd">  "theme": "base",</span>
<span class="sd">  "themeVariables": {</span>
<span class="sd">      "primaryColor": "#fff",</span>
<span class="sd">      "primaryBorderColor": "#fff",</span>
<span class="sd">      "mainBkg": "#32C8CD",</span>
<span class="sd">      "clusterBkg": "#EEEDE78C",</span>
<span class="sd">      "secondaryBorderColor": "none",</span>
<span class="sd">      "tertiaryBorderColor": "none",</span>
<span class="sd">      "lineColor": "#a6d8da"</span>
<span class="sd">      }</span>
<span class="sd">}}%%</span>
<span class="sd">            '''</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">''</span>
            <span class="p">),</span>
            <span class="s1">'flowchart LR;'</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">pod_nodes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># plot subgraphs</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pod_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">_mermaid_str</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">need</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">needs</span><span class="p">):</span>
                <span class="n">need_print</span> <span class="o">=</span> <span class="n">need</span>
                <span class="k">if</span> <span class="n">need</span> <span class="o">==</span> <span class="s1">'gateway'</span><span class="p">:</span>
                    <span class="n">need_print</span> <span class="o">=</span> <span class="s1">'gatewaystart[gateway]'</span>
                <span class="n">node_print</span> <span class="o">=</span> <span class="n">node</span>
                <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">'gateway'</span><span class="p">:</span>
                    <span class="n">node_print</span> <span class="o">=</span> <span class="s1">'gatewayend[gateway]'</span>

                <span class="n">_s_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">need</span><span class="p">]</span><span class="o">.</span><span class="n">role</span>
                <span class="n">_e_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">role</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">need</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">'external'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">_s_role</span> <span class="o">=</span> <span class="s1">'EXTERNAL'</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">'external'</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">_e_role</span> <span class="o">=</span> <span class="s1">'EXTERNAL'</span>
                <span class="n">line_st</span> <span class="o">=</span> <span class="s1">'--&gt;'</span>
                <span class="k">if</span> <span class="n">_s_role</span> <span class="o">==</span> <span class="n">PodRoleType</span><span class="o">.</span><span class="n">INSPECT</span> <span class="ow">or</span> <span class="n">_e_role</span> <span class="o">==</span> <span class="n">PodRoleType</span><span class="o">.</span><span class="n">INSPECT</span><span class="p">:</span>
                    <span class="n">line_st</span> <span class="o">=</span> <span class="s1">'-.-&gt;'</span>
                <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">need_print</span><span class="si">}</span><span class="s1">:::</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">_s_role</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">line_st</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">node_print</span><span class="si">}</span><span class="s1">:::</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">_e_role</span><span class="p">)</span><span class="si">}</span><span class="s1">;'</span>
                <span class="p">)</span>

        <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">'classDef </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">INSPECT</span><span class="p">)</span><span class="si">}</span><span class="s1"> stroke:#F29C9F'</span><span class="p">)</span>

        <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">'classDef </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">JOIN_INSPECT</span><span class="p">)</span><span class="si">}</span><span class="s1"> stroke:#F29C9F'</span><span class="p">)</span>
        <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">'classDef </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">GATEWAY</span><span class="p">)</span><span class="si">}</span><span class="s1"> fill:none,color:#000,stroke:none'</span>
        <span class="p">)</span>
        <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">'classDef </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">PodRoleType</span><span class="o">.</span><span class="n">INSPECT_AUX_PASS</span><span class="p">)</span><span class="si">}</span><span class="s1"> stroke-dasharray: 2 2'</span>
        <span class="p">)</span>
        <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">'classDef HEADTAIL fill:#32C8CD1D'</span><span class="p">)</span>

        <span class="n">mermaid_graph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="se">\n</span><span class="s1">classDef EXTERNAL fill:#fff,stroke:#32C8CD'</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mermaid_graph</span><span class="p">)</span>

<div class="viewcode-block" id="Flow.plot"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vertical_layout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">inline_display</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">build</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">copy_flow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Visualize the Flow up to the current point</span>
<span class="sd">        If a file name is provided it will create a jpg image with that name,</span>
<span class="sd">        otherwise it will display the URL for mermaid.</span>
<span class="sd">        If called within IPython notebook, it will be rendered inline,</span>
<span class="sd">        otherwise an image will be created.</span>

<span class="sd">        Example,</span>

<span class="sd">        .. highlight:: python</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            flow = Flow().add(name='pod_a').plot('flow.svg')</span>

<span class="sd">        :param output: a filename specifying the name of the image to be created,</span>
<span class="sd">                    the suffix svg/jpg determines the file type of the output image</span>
<span class="sd">        :param vertical_layout: top-down or left-right layout</span>
<span class="sd">        :param inline_display: show image directly inside the Jupyter Notebook</span>
<span class="sd">        :param build: build the Flow first before plotting, gateway connection can be better showed</span>
<span class="sd">        :param copy_flow: when set to true, then always copy the current Flow and</span>
<span class="sd">                do the modification on top of it then return, otherwise, do in-line modification</span>
<span class="sd">        :return: the Flow</span>
<span class="sd">        """</span>

        <span class="c1"># deepcopy causes the below error while reusing a Flow in Jupyter</span>
        <span class="c1"># 'Pickling an AuthenticationString object is disallowed for security reasons'</span>
        <span class="n">op_flow</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">copy_flow</span> <span class="k">else</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">build</span><span class="p">:</span>
            <span class="n">op_flow</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">mermaid_str</span> <span class="o">=</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_mermaid_str</span>
        <span class="k">if</span> <span class="n">vertical_layout</span><span class="p">:</span>
            <span class="n">mermaid_str</span> <span class="o">=</span> <span class="n">mermaid_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'flowchart LR'</span><span class="p">,</span> <span class="s1">'flowchart TD'</span><span class="p">)</span>

        <span class="n">image_type</span> <span class="o">=</span> <span class="s1">'svg'</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'svg'</span><span class="p">):</span>
            <span class="n">image_type</span> <span class="o">=</span> <span class="s1">'img'</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">op_flow</span><span class="o">.</span><span class="n">_mermaid_to_url</span><span class="p">(</span><span class="n">mermaid_str</span><span class="p">,</span> <span class="n">image_type</span><span class="p">)</span>
        <span class="n">showed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">inline_display</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Image</span>

                <span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
                <span class="n">showed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># no need to panic users</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">download_mermaid_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">showed</span><span class="p">:</span>
            <span class="n">op_flow</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">'flow visualization: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Displays the object in IPython as a side effect"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">inline_display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">!=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mermaid_to_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mermaid_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">img_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""</span>
<span class="sd">        Render the current Flow as URL points to a SVG. It needs internet connection</span>

<span class="sd">        :param mermaid_str: the mermaid representation</span>
<span class="sd">        :param img_type: image type (svg/jpg)</span>
<span class="sd">        :return: the url points to a SVG</span>
<span class="sd">        """</span>
        <span class="n">encoded_str</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">mermaid_str</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">'https://mermaid.ink/</span><span class="si">{</span><span class="n">img_type</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">encoded_str</span><span class="si">}</span><span class="s1">'</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">port_expose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""Return the exposed port of the gateway</span>
<span class="sd">        .. # noqa: DAR201</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">GATEWAY_NAME</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">port_expose</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'port_expose'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@port_expose</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">port_expose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">"""Set the new exposed port of the Flow (affects Gateway and Client)</span>

<span class="sd">        :param value: the new port to expose</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'port_expose'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Flow is build to graph already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">&gt;=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">port_expose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'port_expose'</span><span class="p">]</span>

        <span class="c1"># Flow is running already, then close the existing gateway</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">&gt;=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">wait_start_success</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">host</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""Return the local address of the gateway</span>
<span class="sd">        .. # noqa: DAR201</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">GATEWAY_NAME</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">host</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'host'</span><span class="p">,</span> <span class="n">__default_host__</span><span class="p">)</span>

    <span class="nd">@host</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">host</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">"""Set the new host of the Flow (affects Gateway and Client)</span>

<span class="sd">        :param value: the new port to expose</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'host'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Flow is build to graph already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">&gt;=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'host'</span><span class="p">]</span>

        <span class="c1"># Flow is running already, then close the existing gateway</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">&gt;=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">wait_start_success</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">address_private</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""Return the private IP address of the gateway for connecting from other machine in the same network</span>


<span class="sd">        .. # noqa: DAR201"""</span>
        <span class="k">return</span> <span class="n">get_internal_ip</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">address_public</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""Return the public IP address of the gateway for connecting from other machine in the public network</span>


<span class="sd">        .. # noqa: DAR201"""</span>
        <span class="k">return</span> <span class="n">get_public_ip</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_address_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address_table</span><span class="p">):</span>
        <span class="n">address_table</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s1">'</span><span class="se">\t</span><span class="s1"> Protocol: </span><span class="se">\t\t</span><span class="si">{</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">'</span><span class="se">\t</span><span class="s1"> Local access:</span><span class="se">\t</span><span class="s1">'</span>
                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port_expose</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'cyan'</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="s1">'underline'</span><span class="p">),</span>
                <span class="sa">f</span><span class="s1">'</span><span class="se">\t</span><span class="s1"> Private network:</span><span class="se">\t</span><span class="s1">'</span>
                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address_private</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port_expose</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
                    <span class="s1">'cyan'</span><span class="p">,</span>
                    <span class="n">attrs</span><span class="o">=</span><span class="s1">'underline'</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">address_public</span><span class="p">:</span>
            <span class="n">address_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'</span><span class="se">\t</span><span class="s1"> Public address:</span><span class="se">\t</span><span class="s1">'</span>
                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">address_public</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port_expose</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
                    <span class="s1">'cyan'</span><span class="p">,</span>
                    <span class="n">attrs</span><span class="o">=</span><span class="s1">'underline'</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">GatewayProtocolType</span><span class="o">.</span><span class="n">HTTP</span><span class="p">:</span>
            <span class="n">address_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'</span><span class="se">\t</span><span class="s1"> Swagger UI:</span><span class="se">\t\t</span><span class="s1">'</span>
                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'http://localhost:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port_expose</span><span class="si">}</span><span class="s1">/docs'</span><span class="p">,</span>
                    <span class="s1">'cyan'</span><span class="p">,</span>
                    <span class="n">attrs</span><span class="o">=</span><span class="s1">'underline'</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">address_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'</span><span class="se">\t</span><span class="s1"> Redoc:</span><span class="se">\t\t</span><span class="s1">'</span>
                <span class="o">+</span> <span class="n">colored</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'http://localhost:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port_expose</span><span class="si">}</span><span class="s1">/redoc'</span><span class="p">,</span>
                    <span class="s1">'cyan'</span><span class="p">,</span>
                    <span class="n">attrs</span><span class="o">=</span><span class="s1">'underline'</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">address_table</span>

<div class="viewcode-block" id="Flow.block"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.block">[docs]</a>    <span class="k">def</span> <span class="nf">block</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">,</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">"""Block the Flow until `stop_event` is set or user hits KeyboardInterrupt</span>

<span class="sd">        :param stop_event: a threading event or a multiprocessing event that onces set will resume the control Flow</span>
<span class="sd">            to main thread.</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stop_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
                <span class="p">)</span>  <span class="c1">#: this allows `.close` to close the Flow from another thread/proc</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stop_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stop_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">pass</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GatewayProtocolType</span><span class="p">:</span>
        <span class="sd">"""Return the protocol of this Flow</span>

<span class="sd">        :return: the protocol of this Flow</span>
<span class="sd">        """</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'protocol'</span><span class="p">,</span> <span class="n">GatewayProtocolType</span><span class="o">.</span><span class="n">GRPC</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">GatewayProtocolType</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@protocol</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">GatewayProtocolType</span><span class="p">]):</span>
        <span class="sd">"""Set the protocol of this Flow</span>

<span class="sd">        :param value: the protocol to set</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'protocol'</span><span class="p">]</span> <span class="o">=</span> <span class="n">GatewayProtocolType</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GatewayProtocolType</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'protocol'</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> must be either `str` or `GatewayProtocolType`'</span><span class="p">)</span>

        <span class="c1"># Flow is build to graph already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">&gt;=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">GRAPH</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'protocol'</span><span class="p">]</span>

        <span class="c1"># Flow is running already, then close the existing gateway</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_level</span> <span class="o">&gt;=</span> <span class="n">FlowBuildLevel</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">GATEWAY_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">wait_start_success</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">typename</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s1"> is not supported'</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workspace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""Return the workspace path of the flow.</span>

<span class="sd">        .. # noqa: DAR201"""</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">workspace</span> <span class="ow">or</span> <span class="s1">'./'</span><span class="p">)</span>

    <span class="nd">@workspace</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">workspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">"""set workspace dir for flow &amp; all pods</span>

<span class="sd">        :param value: workspace to be set</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workspace_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">"""Get all Pods' ``workspace_id`` values in a dict</span>


<span class="sd">        .. # noqa: DAR201"""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">workspace_id</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">'workspace_id'</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="nd">@workspace_id</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">workspace_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">"""Set all Pods' ``workspace_id`` to ``value``</span>

<span class="sd">        :param value: a hexadecimal UUID string</span>
<span class="sd">        """</span>
        <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">'workspace_id'</span><span class="p">):</span>
                <span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">workspace_id</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">'peas_args'</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">'shards_args'</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'could not find "peas_args" or "shards_args" on </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">'</span>
                    <span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">args</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
                        <span class="n">v</span><span class="o">.</span><span class="n">workspace_id</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                            <span class="n">i</span><span class="o">.</span><span class="n">workspace_id</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">"""Get all envs to be set in the Flow</span>

<span class="sd">        :return: envs as dict</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">env</span>

    <span class="nd">@env</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="sd">"""set env vars for flow &amp; all pods.</span>
<span class="sd">        This can be used by jinad to set envs for Flow and all child objects</span>

<span class="sd">        :param value: value to be set</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">"""Get all Pods' ``identity`` values in a dict</span>


<span class="sd">        .. # noqa: DAR201</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">identity</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">}</span>

    <span class="nd">@identity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">"""Set all Pods' ``identity`` to ``value``</span>

<span class="sd">        :param value: a hexadecimal UUID string</span>
<span class="sd">        """</span>
        <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># Re-initiating logger with new identity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">JinaLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">expose_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exec_endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Expose an Executor's endpoint (defined by `@requests(on=...)`) to HTTP endpoint for easier access.</span>

<span class="sd">        After expose, you can send data request directly to `http://hostname:port/endpoint`.</span>

<span class="sd">        :param exec_endpoint: the endpoint string, by convention starts with `/`</span>
<span class="sd">        :param path: the HTTP endpoint string, when not given, it is `exec_endpoint`</span>
<span class="sd">        """</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">expose_endpoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exec_endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">summary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'Successful Response'</span><span class="p">,</span>
        <span class="n">deprecated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">methods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">operation_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_model_by_alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">response_model_exclude_unset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">response_model_exclude_defaults</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">response_model_exclude_none</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">include_in_schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">"""Expose an Executor's endpoint (defined by `@requests(on=...)`) to HTTP endpoint for easier access.</span>

<span class="sd">        After expose, you can send data request directly to `http://hostname:port/endpoint`.</span>

<span class="sd">        Use this method to specify your HTTP endpoint with richer semantic and schema.</span>

<span class="sd">        :param exec_endpoint: the endpoint string, by convention starts with `/`</span>

<span class="sd">        # noqa: DAR101</span>
<span class="sd">        """</span>
        <span class="o">...</span>

<div class="viewcode-block" id="Flow.expose_endpoint"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.expose_endpoint">[docs]</a>    <span class="k">def</span> <span class="nf">expose_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exec_endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""Expose an Executor's endpoint (defined by `@requests(on=...)`) to HTTP endpoint for easier access.</span>

<span class="sd">        After expose, you can send data request directly to `http://hostname:port/endpoint`.</span>

<span class="sd">        :param exec_endpoint: the endpoint string, by convention starts with `/`</span>

<span class="sd">        # noqa: DAR101</span>
<span class="sd">        # noqa: DAR102</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endpoints_mapping</span><span class="p">[</span><span class="n">exec_endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span></div>

    <span class="c1"># for backward support</span>
    <span class="n">join</span> <span class="o">=</span> <span class="n">needs</span>

<div class="viewcode-block" id="Flow.rolling_update"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.rolling_update">[docs]</a>    <span class="k">def</span> <span class="nf">rolling_update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pod_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dump_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">uses_with</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Reload all replicas of a pod sequentially</span>

<span class="sd">        :param pod_name: pod to update</span>
<span class="sd">        :param dump_path: **backwards compatibility** This function was only accepting dump_path as the only potential arg to override</span>
<span class="sd">        :param uses_with: a Dictionary of arguments to restart the executor with</span>
<span class="sd">        """</span>
        <span class="kn">from</span> <span class="nn">..helper</span> <span class="kn">import</span> <span class="n">run_async</span>

        <span class="n">run_async</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod_name</span><span class="p">]</span><span class="o">.</span><span class="n">rolling_update</span><span class="p">,</span>
            <span class="n">dump_path</span><span class="o">=</span><span class="n">dump_path</span><span class="p">,</span>
            <span class="n">uses_with</span><span class="o">=</span><span class="n">uses_with</span><span class="p">,</span>
            <span class="n">any_event_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Flow.scale"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pod_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">replicas</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Scale the amount of replicas of a given Executor.</span>

<span class="sd">        :param pod_name: pod to update</span>
<span class="sd">        :param replicas: The number of replicas to scale to</span>
<span class="sd">        """</span>

        <span class="c1"># TODO when replicas-host is ready, needs to be passed here</span>

        <span class="kn">from</span> <span class="nn">..helper</span> <span class="kn">import</span> <span class="n">run_async</span>

        <span class="n">run_async</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pod_nodes</span><span class="p">[</span><span class="n">pod_name</span><span class="p">]</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">replicas</span><span class="o">=</span><span class="n">replicas</span><span class="p">,</span>
            <span class="n">any_event_loop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">client_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
        <span class="sd">"""Get Client settings.</span>

<span class="sd">        # noqa: DAR201</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="s1">'port_expose'</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">'port'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">[</span><span class="s1">'port_expose'</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ArgNamespace</span><span class="o">.</span><span class="n">kwargs2namespace</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">set_client_cli_parser</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gateway_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
        <span class="sd">"""Get Gateway settings.</span>

<span class="sd">        # noqa: DAR201</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">ArgNamespace</span><span class="o">.</span><span class="n">kwargs2namespace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="p">,</span> <span class="n">set_gateway_parser</span><span class="p">())</span>

<div class="viewcode-block" id="Flow.update_network_interface"><a class="viewcode-back" href="../../../../api/jina.flow.base/#jina.Flow.update_network_interface">[docs]</a>    <span class="k">def</span> <span class="nf">update_network_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""Update the network interface of this Flow (affects Gateway &amp; Client)</span>

<span class="sd">        :param kwargs: new network settings</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_common_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div></div>
</pre></div>
            </article>
            <footer>
                
                <div class="related-pages">
                    
                    
                </div>

                <div class="related-information sd-d-inline-flex">
                    <a href="https://jina.ai">Copyright &#169; Jina AI Limited. All rights reserved.</a>
                    Last updated on Dec 02, 2021.
                    <div class="social-btns">
                    <a class='social-btn' href="https://github.com/jina-ai/jina/" aria-label="GitHub" target="_blank" rel="noreferrer"> <i class="fab fa-github"></i></a>
                    <a class='social-btn' href="https://slack.jina.ai" aria-label="Slack" target="_blank" rel="noreferrer"> <i class="fab fa-slack"></i></a>
                    <a class='social-btn' href="https://youtube.com/c/jina-ai" aria-label="YouTube" target="_blank" rel="noreferrer"> <i class="fab fa-youtube"></i></a>
                    <a class='social-btn' href="https://twitter.com/JinaAI_" aria-label="Twitter" target="_blank" rel="noreferrer"> <i class="fab fa-twitter"></i></a>
                    <a class='social-btn' href="https://www.linkedin.com/company/jinaai/" aria-label="LinkedIn" target="_blank" rel="noreferrer"> <i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
                
            </footer>
        </div>
        <aside class="toc-drawer" id="toc-drawer">
            

            <div class="toc-sticky toc-scroll">
                
                <details id='jina-docbot' class="jina-doc-bot sd-sphinx-override sd-dropdown sd-card" v-bind:class="{ready: ready}">
    <summary class="sd-summary-title sd-card-header">
        <svg aria-hidden="true" class="sd-octicon sd-octicon-comment-discussion" height="1.0em"
             version="1.1" viewBox="0 0 16 16" width="1.0em">
            <path d="M1.5 2.75a.25.25 0 01.25-.25h8.5a.25.25 0 01.25.25v5.5a.25.25 0 01-.25.25h-3.5a.75.75 0 00-.53.22L3.5 11.44V9.25a.75.75 0 00-.75-.75h-1a.25.25 0 01-.25-.25v-5.5zM1.75 1A1.75 1.75 0 000 2.75v5.5C0 9.216.784 10 1.75 10H2v1.543a1.457 1.457 0 002.487 1.03L7.061 10h3.189A1.75 1.75 0 0012 8.25v-5.5A1.75 1.75 0 0010.25 1h-8.5zM14.5 4.75a.25.25 0 00-.25-.25h-.5a.75.75 0 110-1.5h.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0114.25 12H14v1.543a1.457 1.457 0 01-2.487 1.03L9.22 12.28a.75.75 0 111.06-1.06l2.22 2.22v-2.19a.75.75 0 01.75-.75h1a.25.25 0 00.25-.25v-5.5z"
                  fill-rule="evenodd"></path>
        </svg>
        &nbsp; Ask our docs!
        <div class="sd-summary-down docutils">
            <svg aria-hidden="true" class="sd-octicon sd-octicon-chevron-down" height="1.5em"
                 version="1.1" viewBox="0 0 24 24" width="1.5em">
                <path d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"
                      fill-rule="evenodd"></path>
            </svg>
        </div>
        <div class="sd-summary-up docutils">
            <svg aria-hidden="true" class="sd-octicon sd-octicon-chevron-up" height="1.5em"
                 version="1.1" viewBox="0 0 24 24" width="1.5em">
                <path d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"
                      fill-rule="evenodd"></path>
            </svg>
        </div>
    </summary>
    <div class="sd-summary-content docutils">
        <div class="jina-doc-answer">
            <div class="jina-doc-answer-hint" v-if="qa_pairs.length===0">
                <p class="jina-doc-bot-help-text sd-font-weight-bold" v-if="!ready">Chat loading...<br><br> You can think of questions while our bot load. Try:</p>
                <p class="jina-doc-bot-help-text sd-font-weight-bold hidden-before-ready" v-else>You can ask questions about our docs. Try:</p>
                <ul class="example-question simple sd-font-weight-light">
                    <li><p>Does Jina support Kubernetes?</p></li>
                    <li><p>How can I traverse a nested DocumentArray?</p></li>
                    <li><p>What are the basic concepts in Jina?</p></li>
                </ul>
            </div>
            <div class="jina-doc-answer-dialog hidden-before-ready" v-else>
                <div v-for="qa in qa_pairs" class="qa-container">
                    <div v-if="qa.question" class="sd-text-right">
                        <div class="talk-bubble question-bubble">
                            <div class="talktext">
                                <p>${qa.question}</p>
                            </div>
                        </div>
                    </div>
                    <div class="talk-bubble answer-bubble">
                        <div class="talktext">
                            <p v-if="qa.answer">${qa.answer.text}</p>
                            <div v-else>
                                <svg height="10" width="40" class="loader">
                                    <circle class="dot" cx="10" cy="5" r="3"/>
                                    <circle class="dot" cx="20" cy="5" r="3"/>
                                    <circle class="dot" cx="30" cy="5" r="3"/>
                                </svg>
                            </div>
                        </div>
                        <a v-if="qa.answer && is_conn_broken" class="answer-reference" href="https://slack.jina.ai"
                           target="_blank">Report</a>
                        <div v-if="qa.answer && !is_conn_broken && qa.answer.uri" class="feedback-tooltip sd-d-flex-row">
                            <a class="answer-reference" :href="root_url + qa.answer.uri">Source</a>
                            <div class="sd-d-flex-row">
                                <div class="thumb-answer thumbup" v-show="qa.rating===null" style="margin: 0 6px" v-on:click="submit_rating(qa, true)">
                                    <svg aria-hidden="true" class="sd-octicon sd-octicon-thumbsup" height="1.0em"
                                         version="1.1" viewBox="0 0 16 16" width="1.0em">
                                        <path d="M8.834.066C7.494-.087 6.5 1.048 6.5 2.25v.5c0 1.329-.647 2.124-1.318 2.614-.328.24-.66.403-.918.508A1.75 1.75 0 002.75 5h-1A1.75 1.75 0 000 6.75v7.5C0 15.216.784 16 1.75 16h1a1.75 1.75 0 001.662-1.201c.525.075 1.067.229 1.725.415.152.043.31.088.475.133 1.154.32 2.54.653 4.388.653 1.706 0 2.97-.153 3.722-1.14.353-.463.537-1.042.668-1.672.118-.56.208-1.243.313-2.033l.04-.306c.25-1.869.265-3.318-.188-4.316a2.418 2.418 0 00-1.137-1.2C13.924 5.085 13.353 5 12.75 5h-1.422l.015-.113c.07-.518.157-1.17.157-1.637 0-.922-.151-1.719-.656-2.3-.51-.589-1.247-.797-2.01-.884zM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.922.922 0 00-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.861 5.861 0 01-1.567.81V13.3zM2.75 6.5a.25.25 0 01.25.25v7.5a.25.25 0 01-.25.25h-1a.25.25 0 01-.25-.25v-7.5a.25.25 0 01.25-.25h1z"
                                              fill-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div class="thumb-answer thumbdown" v-show="qa.rating===null" v-on:click="submit_rating(qa, false)">
                                    <svg aria-hidden="true" class="sd-octicon sd-octicon-thumbsdown" height="1.0em"
                                         version="1.1" viewBox="0 0 16 16" width="1.0em">
                                        <path d="M7.083 15.986c1.34.153 2.334-.982 2.334-2.183v-.5c0-1.329.646-2.123 1.317-2.614.329-.24.66-.403.919-.508a1.75 1.75 0 001.514.872h1a1.75 1.75 0 001.75-1.75v-7.5a1.75 1.75 0 00-1.75-1.75h-1a1.75 1.75 0 00-1.662 1.2c-.525-.074-1.068-.228-1.726-.415L9.305.705C8.151.385 6.765.053 4.917.053c-1.706 0-2.97.152-3.722 1.139-.353.463-.537 1.042-.669 1.672C.41 3.424.32 4.108.214 4.897l-.04.306c-.25 1.869-.266 3.318.188 4.316.244.537.622.943 1.136 1.2.495.248 1.066.334 1.669.334h1.422l-.015.112c-.07.518-.157 1.17-.157 1.638 0 .921.151 1.718.655 2.299.512.589 1.248.797 2.011.884zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479a63.914 63.914 0 00-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.921.921 0 00.443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.862 5.862 0 011.568-.809V2.754zm1.75 6.798a.25.25 0 01-.25-.25v-7.5a.25.25 0 01.25-.25h1a.25.25 0 01.25.25v7.5a.25.25 0 01-.25.25h-1z"
                                              fill-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>


        </div>
        <div class="jina-doc-bot-controls sd-d-flex-row sd-border-1">
            <textarea v-model="cur_question" class="sd-border-0" maxlength="100" rows="3"
                      id="bot-input-question"
                      style="width: 100%"
                      placeholder="Just a moment, please ..."
                      :placeholder="'Type your question here'"
                      v-on:keyup.enter="submit_q"
                      disabled
                      :disabled="!ready"
                      :readonly="is_busy" autofocus></textarea>
            <button class="sd-sphinx-override sd-btn sd-text-wrap sd-btn-outline-primary sd-rounded-0 hidden-before-ready"
                    v-on:click="submit_q" v-show="cur_question.length>0 && !is_busy" id="bot-input-btn">
                <svg aria-hidden="true" class="sd-octicon sd-octicon-paper-airplane" height="1.0em"
                     version="1.1" viewBox="0 0 16 16" width="1.0em">
                    <path d="M1.592 2.712L2.38 7.25h4.87a.75.75 0 110 1.5H2.38l-.788 4.538L13.929 8 1.592 2.712zM.989 8L.064 2.68a1.341 1.341 0 011.85-1.462l13.402 5.744a1.13 1.13 0 010 2.076L1.913 14.782a1.341 1.341 0 01-1.85-1.463L.99 8z"
                          fill-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <div class="powered-by">
        </div>
    </div>
</details>
            </div>

            
        </aside>

    </div>
</div><script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/scripts/main.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/tabs.js"></script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script>var server_address = 'https://docsbot.jina.ai';</script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js"></script>
    <script src="../../../../_static/docbot.js"></script>
    <script src="../../../../_static/iframe.js"></script>
    </body>
</html>